<!doctype html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<title>DIY lost plane alarm finder and 10 watts LED visual aids for easy orientation - end2end zone</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png?v=1">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png?v=1">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png?v=1">
  <link rel="manifest" href="/favicon/site.webmanifest?v=1">
  
    <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg?v=1" color="#ffffff">
    <link rel="shortcut icon" href="/favicon/favicon.ico?v=1">
    <meta name="msapplication-config" content="/favicon/browserconfig.xml?v=1">
  
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">

<meta name="generator" content="Hugo 0.87.0" /><meta property="og:site_name" content="end2end zone">
  <meta property="og:title" content="DIY lost plane alarm finder and 10 watts LED visual aids for easy orientation">
  <meta property="og:description" content="end2end zone">
  <meta property="description" content="end2end zone">
  <meta property="og:url" content="http://www.end2endzone.com/diy-lost-plane-alarm-finder-and-10-watts-led-visual-aids-for-easy-orientation/">
  <meta property="og:type" content="article">
  
    
      <meta property="og:image" content="http://www.end2endzone.com/wp-content/uploads/2016/10/Arduino-Quadcopter-Controler-featured.jpg">
      <meta property="og:image:alt" content="">
    
  
  <link rel="stylesheet" href="/css/bundle.min.1bfccf86359e3de974865922b006112447a52f942c2a9c2bf93d159980ae641b.css" integrity="sha256-G/zPhjWePel0hlkisAYRJEelL5QsKpwr&#43;T0VmYCuZBs="><link rel="stylesheet" href="/css/add-on.css">
        <link rel="stylesheet" href="/css/end2endzone.css">
        <link rel="stylesheet" href="/css/button.css">
        <link rel="stylesheet" href="/css/syntax.css">
</head>

  <body>
    

<header id="site-header">
  <nav id="site-nav">
    <h1 class="nav-title">
      <a href="/" class="nav">
        
          Blog
        
      </a>
    </h1>
    <menu id="site-nav-menu" class="flyout-menu menu">
      
        
          
          <a href="/" class="nav link"><i class='fa fa-home'></i> Home</a>
        
      
        
          
          <a href="/about" class="nav link"><i class='far fa-id-card'></i> About</a>
        
      
        
          
          <a href="/blog" class="nav link"><i class='far fa-newspaper'></i> Blog</a>
        
      
        
          
          <a href="/categories" class="nav link"><i class='fas fa-sitemap'></i> Categories</a>
        
      
        
          
          <a href="/tags" class="nav link"><i class='fas fa-sitemap'></i> Tags</a>
        
      
        
          
          <a href="/contact" class="nav link"><i class='far fa-envelope'></i> Contact</a>
        
      
      <a href="#share-menu" class="nav link share-toggle"><i class="fas fa-share-alt">&nbsp;</i>Share</a>
      <a href="#search-input" class="nav link search-toggle"><i class="fas fa-search">&nbsp;</i>Search</a>
    </menu>
    <a href="#search-input" class="nav search-toggle"><i class="fas fa-search fa-2x">&nbsp;</i></a>
    <a href="#share-menu" class="nav share-toggle"><i class="fas fa-share-alt fa-2x">&nbsp;</i></a>
    <a href="#lang-menu" class="nav lang-toggle" lang="en">en</a>
    <a href="#site-nav" class="nav nav-toggle"><i class="fas fa-bars fa-2x"></i></a>
  </nav>
  <menu id="search" class="menu"><input id="search-input" class="search-input menu"></input><div id="search-results" class="search-results menu"></div></menu>
  <menu id="lang-menu" class="flyout-menu menu">
  <a href="#" lang="en" class="nav link active">English (en)</a>
  
    
      
    
      
        <a href="/fr" lang="fr" class="nav no-lang link">Fran√ßais (fr)</a>
      
    
  
</menu>

  
    <menu id="share-menu" class="flyout-menu menu">
      <h1>Share Post</h1>
      




  
    
    <a href="//twitter.com/share?text=DIY%20lost%20plane%20alarm%20finder%20and%2010%20watts%20LED%20visual%20aids%20for%20easy%20orientation&amp;url=http%3a%2f%2fwww.end2endzone.com%2fdiy-lost-plane-alarm-finder-and-10-watts-led-visual-aids-for-easy-orientation%2f" target="_blank" rel="noopener" class="nav share-btn twitter">
        <p>Twitter</p>
      </a>
  

  
      <a href="//www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fwww.end2endzone.com%2fdiy-lost-plane-alarm-finder-and-10-watts-led-visual-aids-for-easy-orientation%2f" target="_blank" rel="noopener" class="nav share-btn facebook">
        <p>Facebook</p>
        </a>
  

  
    <a href="//www.reddit.com/submit?url=http%3a%2f%2fwww.end2endzone.com%2fdiy-lost-plane-alarm-finder-and-10-watts-led-visual-aids-for-easy-orientation%2f&amp;title=DIY%20lost%20plane%20alarm%20finder%20and%2010%20watts%20LED%20visual%20aids%20for%20easy%20orientation" target="_blank" rel="noopener" class="nav share-btn reddit">
          <p>Reddit</p>
        </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=http%3a%2f%2fwww.end2endzone.com%2fdiy-lost-plane-alarm-finder-and-10-watts-led-visual-aids-for-easy-orientation%2f&amp;title=DIY%20lost%20plane%20alarm%20finder%20and%2010%20watts%20LED%20visual%20aids%20for%20easy%20orientation" target="_blank" rel="noopener" class="nav share-btn linkedin">
            <p>LinkedIn</p>
          </a>
  

  
        <a href="//www.pinterest.com/pin/create/button/?url=http%3a%2f%2fwww.end2endzone.com%2fdiy-lost-plane-alarm-finder-and-10-watts-led-visual-aids-for-easy-orientation%2f&amp;description=DIY%20lost%20plane%20alarm%20finder%20and%2010%20watts%20LED%20visual%20aids%20for%20easy%20orientation" target="_blank" rel="noopener" class="nav share-btn pinterest">
          <p>Pinterest</p>
        </a>
  

  
        <a href="mailto:?subject=Check%20out%20this%20post%20by end2end&amp;body=http%3a%2f%2fwww.end2endzone.com%2fdiy-lost-plane-alarm-finder-and-10-watts-led-visual-aids-for-easy-orientation%2f" target="_blank" class="nav share-btn email" data-proofer-ignore>
          <p>Email</p>
        </a>
  


    </menu>
  
</header>

    <div id="wrapper">
      <section id="site-intro" >
  <a href="/"><img src="http://www.end2endzone.com/img/main/logo.jpg" class="circle" width="100" alt="Hey that&#39;s me" /></a>
  <header>
    <h1>end2end zone</h1>
  </header>
  <main>
    <p>My life dumped to a web site</p>
  </main>
  
    <footer>
      <ul class="socnet-icons">
        

        <li><a href="//github.com/end2endzone" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>

<li><a href="//stackoverflow.com/users/16481711" target="_blank" rel="noopener" title="Stack Overflow" class="fab fa-stack-overflow"></a></li>




<li><a href="//flickr.com/photos/154618444@N05" target="_blank" rel="noopener" title="Flickr" class="fab fa-flickr"></a></li>









<li><a href="//facebook.com/antoine.beauchamp.90" target="_blank" rel="noopener" title="Facebook" class="fab fa-facebook"></a></li>
























      </ul>
    </footer>
  
</section>

      <main id="site-main">
        
  <article>
    <div class="post">
      <header>
  <div class="title">
    
      <h2><a href="/diy-lost-plane-alarm-finder-and-10-watts-led-visual-aids-for-easy-orientation/">DIY lost plane alarm finder and 10 watts LED visual aids for easy orientation</a></h2>
    
    
  </div>
  <div class="meta">
    <time datetime="2016-10-27 16:48:23 &#43;0000 &#43;0000">October 27, 2016</time>
    <p>end2end</p>
    <p>30-Minute Read</p>
  </div>
</header>

	  
      
      
        <div id="socnet-share">
          




  
    
    <a href="//twitter.com/share?text=DIY%20lost%20plane%20alarm%20finder%20and%2010%20watts%20LED%20visual%20aids%20for%20easy%20orientation&amp;url=http%3a%2f%2fwww.end2endzone.com%2fdiy-lost-plane-alarm-finder-and-10-watts-led-visual-aids-for-easy-orientation%2f" target="_blank" rel="noopener" class="nav share-btn twitter">
        <p>Twitter</p>
      </a>
  

  
      <a href="//www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fwww.end2endzone.com%2fdiy-lost-plane-alarm-finder-and-10-watts-led-visual-aids-for-easy-orientation%2f" target="_blank" rel="noopener" class="nav share-btn facebook">
        <p>Facebook</p>
        </a>
  

  
    <a href="//www.reddit.com/submit?url=http%3a%2f%2fwww.end2endzone.com%2fdiy-lost-plane-alarm-finder-and-10-watts-led-visual-aids-for-easy-orientation%2f&amp;title=DIY%20lost%20plane%20alarm%20finder%20and%2010%20watts%20LED%20visual%20aids%20for%20easy%20orientation" target="_blank" rel="noopener" class="nav share-btn reddit">
          <p>Reddit</p>
        </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=http%3a%2f%2fwww.end2endzone.com%2fdiy-lost-plane-alarm-finder-and-10-watts-led-visual-aids-for-easy-orientation%2f&amp;title=DIY%20lost%20plane%20alarm%20finder%20and%2010%20watts%20LED%20visual%20aids%20for%20easy%20orientation" target="_blank" rel="noopener" class="nav share-btn linkedin">
            <p>LinkedIn</p>
          </a>
  

  
        <a href="//www.pinterest.com/pin/create/button/?url=http%3a%2f%2fwww.end2endzone.com%2fdiy-lost-plane-alarm-finder-and-10-watts-led-visual-aids-for-easy-orientation%2f&amp;description=DIY%20lost%20plane%20alarm%20finder%20and%2010%20watts%20LED%20visual%20aids%20for%20easy%20orientation" target="_blank" rel="noopener" class="nav share-btn pinterest">
          <p>Pinterest</p>
        </a>
  

  
        <a href="mailto:?subject=Check%20out%20this%20post%20by end2end&amp;body=http%3a%2f%2fwww.end2endzone.com%2fdiy-lost-plane-alarm-finder-and-10-watts-led-visual-aids-for-easy-orientation%2f" target="_blank" class="nav share-btn email" data-proofer-ignore>
          <p>Email</p>
        </a>
  


        </div>
      
	  
      <div class="content">
        <a href="/diy-lost-plane-alarm-finder-and-10-watts-led-visual-aids-for-easy-orientation/" class="image" style="--bg-image: url('http://www.end2endzone.com/wp-content/uploads/2016/10/Arduino-Quadcopter-Controler-featured.jpg');">
    <img class="stretchV" src="http://www.end2endzone.com/wp-content/uploads/2016/10/Arduino-Quadcopter-Controler-featured.jpg" alt="">
  </a>
		
        
        
          
<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
          Table of contents
        </span>
    </div>
    <div class="expand-content" style="display: none;">
      <aside>
        <nav id="TableOfContents">
  <ol>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#background-story">Background story</a></li>
    <li><a href="#project-summary">Project summary</a>
      <ol>
        <li><a href="#10-watts-led">10 watts LED</a></li>
        <li><a href="#lost-plane-alarm-finder">Lost plane alarm finder</a></li>
        <li><a href="#microcontroller">Microcontroller</a></li>
      </ol>
    </li>
    <li><a href="#project-data">Project data</a>
      <ol>
        <li><a href="#components-and-supplies">Components and Supplies</a>
          <ol>
            <li><a href="#mr16-constant-current-led-driver">MR16 Constant Current LED Driver</a></li>
            <li><a href="#n-channel-power-mosfet">N-Channel Power Mosfet</a></li>
          </ol>
        </li>
        <li><a href="#payload">Payload</a></li>
        <li><a href="#total-cost-of-the-project">Total cost of the project</a></li>
        <li><a href="#preparation-time">Preparation time</a></li>
      </ol>
    </li>
    <li><a href="#schematics">Schematics</a>
      <ol>
        <li><a href="#fritzing-files">Fritzing files</a></li>
        <li><a href="#circuit-diagram">Circuit Diagram</a></li>
        <li><a href="#breadboard-layout">Breadboard Layout</a></li>
      </ol>
    </li>
    <li><a href="#code">Code</a>
      <ol>
        <li><a href="#external-libraries">External libraries</a></li>
        <li><a href="#arduino-sketch">Arduino sketch</a></li>
      </ol>
    </li>
    <li><a href="#building-steps">Building steps</a>
      <ol>
        <li><a href="#install-code-on-arduino">Install code on arduino</a></li>
        <li><a href="#setup-transmitter-tx-mixes">Setup transmitter (Tx) mixes</a></li>
        <li><a href="#build-a-prototype">Build a prototype</a>
          <ol>
            <li><a href="#test-the-code">Test the code</a></li>
            <li><a href="#txrx-prototype-integration">Tx/Rx prototype integration</a></li>
            <li><a href="#test-each-component-optional">Test each component (optional)</a></li>
          </ol>
        </li>
        <li><a href="#solder-components">Solder components</a></li>
        <li><a href="#secure-the-unit-on-the-quadcopter">Secure the unit on the quadcopter</a></li>
        <li><a href="#final-result">Final Result</a></li>
      </ol>
    </li>
    <li><a href="#made-anything-differently">Made anything differently?</a>
      <ol>
        <li><a href="#better-signal-wires">Better signal wires</a></li>
        <li><a href="#other-led-options">Other LED options?</a></li>
        <li><a href="#smaller-form-factor">Smaller form factor</a></li>
        <li><a href="#signal-demultiplexing-nessesary">Signal (de)multiplexing nessesary?</a></li>
        <li><a href="#modular-design">Modular design</a></li>
      </ol>
    </li>
    <li><a href="#references">References</a></li>
    <li><a href="#notes">Notes</a></li>
  </ol>
</nav>
      </aside>
    </div>
</div>

        
		
        <h1 id="introduction">Introduction</h1>
<p>The reason I started this project is because I recently had a bad experience flying a quadcopter too far from me until I was not able to distinguish if the quad was facing me or not. It does not require much distance before a quadcopter looks like a tiny black dot in the sky. Basically, I lost orientation of the quad and I had to land way too far from my takeoff location.</p>
<p>I was in need of more tools (or more ways) to help myself when I will inevitably get into this situation again. The following project explains how I build a DIY solution to help a pilot know a quadcopter orientation when its far away from the point of view and easily locate the quadcopter in case of emergency landing.</p>
<h1 id="background-story">Background story</h1>
<p>I have been flying planes for many years now and over time, I learned to increase my skills and I became a nice pilot. I am still new to the RC hobby and I got pulled into flying quadcopters.</p>
<p>Quadcopters are not piloted the same way as planes. They look safer or easier to pilot since you can always slow down and hover if anything gets out of control.</p>
<p>Recently, I had an interesting experience. I was flying my quad for around 3 months and I felt too much confident: I wanted to try doing flips. Coming from a plane world, I though that climbing to a safe altitude would be the best strategy in case something went wrong.</p>
<p>I got carried away and I ended up to a much higher altitude and further away than I was used to. I tried to drop height and drive the quadcopter back to me but it was too late. The wind was so strong that it moved the quad further away and made the quadcopter swirl. I quickly lost  orientation of the quad and had no way to bring it back.</p>
<p>Luckily, a more experienced pilot help me get the quadcopter back to a safe landing zone which was 615 meters away from my takeoff location.</p>
<p>It took me 3 hours to locate the landing site and find the quad which was still intact!</p>
<p>I learn multiple things this day:</p>
<ul>
<li>I was lacking experience and I need much more practice before attempting stupid aerobatics.</li>
<li>Getting altitude for quadcopters is not as safe as for planes.</li>
<li>It is always better to fly with someone more experienced than you are.</li>
<li>I needed a way to know the orientation of the quad when it is over or away from me.</li>
<li>A lost plane alarm buzzer would have helped me find the quadcopter much quicker.</li>
<li>I was in need of a GPS module and a failsafe mode.</li>
</ul>
<h1 id="project-summary">Project summary</h1>
<p>The DIY solution consist of adding two devices on the quadcopter each device for solving a specific issue.</p>
<h2 id="10-watts-led">10 watts LED</h2>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/10-Watt-LEDs.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/10-Watt-LEDs.jpg" alt="10 Watt LEDs"></a></p>
<p>10 Watt LEDs</p>
<p>The first device is a 10 watts light-emitting diode (LED) mounted to the front of the quadcopter. This option adds to existing visual aids and help the pilot to develop his situation awareness. The front LED allows the pilot to know when the quadcopter is facing him and help the pilot recover in case of lost orientation.</p>
<p>This type of LED is quite bright and provides 900 to 1000 lumens of light which makes it a good candidate to be seen from far away.</p>
<p>As an example, here is a picture of the LED mounted to the quadcopter seen from 333 meters away.</p>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/06/10w-Quadcopter-LED-turned-on-from-333-meters.png"><img src="http://www.end2endzone.com/wp-content/uploads/2016/06/10w-Quadcopter-LED-turned-on-from-333-meters.png" alt="Quadcopter 10 watts LED seen from 333 meters away"></a></p>
<p>Quadcopter 10 watts LED seen from 333 meters away</p>
<p>To help locate the LED location, here is the same point of view with the LED turned off:</p>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/06/10w-Quadcopter-LED-turned-off-from-333-meters.png"><img src="http://www.end2endzone.com/wp-content/uploads/2016/06/10w-Quadcopter-LED-turned-off-from-333-meters.png" alt="Quadcopter 10 watts LED OFF"></a></p>
<p>Quadcopter 10 watts LED OFF</p>
<p class="pleasenote">
  Note that both images are cropped version of <a href="http://www.end2endzone.com/wp-content/uploads/2016/07/10w-Quadcopter-LED-full-image.jpg">the original image</a> which have a much bigger field-of-view.
</p>
<h2 id="lost-plane-alarm-finder">Lost plane alarm finder</h2>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/Piezoelectric-Buzzer-Audible-Alarm-Sound-Buzzers.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/Piezoelectric-Buzzer-Audible-Alarm-Sound-Buzzers.jpg" alt="Piezoelectric Buzzer - Audible Alarm Sound Buzzers"></a></p>
<p>Piezoelectric Buzzer - Audible Alarm Sound Buzzers</p>
<p>The second device is a 95 decibel (dB)¬†<a href="http://en.wikipedia.org/wiki/Piezoelectric_speaker">piezoelectric speaker</a>. This allows the quadcopter to be easily found in case of a crash or an emergency landing. For example, if one enter <a href="http://wiki.dji.com/en/index.php/Naza-M_Enhanced_Failsafe">Failsafe mode</a>, the quadcopter can land immediately (or <a href="http://wiki.dji.com/en/index.php/Inspire_1_Pro-Return_to_Home_(RTH)">Return To Home</a>¬†but that is out of scope) and there is a good chance that it will be far from your takeoff location. Tracking a beep-beep-beep sound is much more easier than estimating the landing location 1 km away.</p>
<p>There are already tons of existing options for a search alarm buzzer on the market, each with their own pros and cons. <a href="http://www.hobbyking.com/hobbyking/store/__14521__HobbyKing_174_Discovery_Buzzer.html">Some buzzer</a> must be connected to a dedicated channel and make sound when flipping a switch on your controller. <a href="http://www.hobbyking.com/hobbyking/store/__13064__Signal_loss_Alarm_Lost_Plane_Finder.html">Others</a> must be connected in series with the throttle channel and rings if the throttle signal has not changed for more than 60 seconds.</p>
<p>However, I prefer the <a href="/tag/diy/">DIY way</a> since it gives more personal satisfaction and the selected option is always the preferred one for my personal needs.</p>
<p>With the DIY route, the piezo buzzer is much louder reaching peaks of 96 dB instead of 60-70 dB since the piezo is powered by the LiPo battery (in my case a 3S 11.1 volts) instead of a poor 5 volts. The sound volume for piezo buzzer is proportional to the voltage used to power the device meaning that a 4S LiPo battery (14.8v) would make it louder than a 3S LiPo.</p>
<h2 id="microcontroller">Microcontroller</h2>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/Arduino-Nano-v3.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/Arduino-Nano-v3.jpg" alt="Arduino Nano v3"></a></p>
<p>Arduino Nano v3</p>
<p>What is different about this project is that it includes an <a href="http://www.arduino.cc/en/Main/ArduinoBoardNano">arduino nano v3</a>, which is a microcontroller. The arduino act as the brain between the pilot and the on-board devices. It allows control of both the LED and the piezo buzzer by reading the quadcopter&rsquo;s receiver signal and forwarding the pilot commands to each device.</p>
<p>This configuration offers much more possibilities. The most obvious is that each device is controlled by the microcontroller instead of a direct channel. This allows advanced logic to be used to implement more features.</p>
<p>As an example, I don&rsquo;t want the LED always turned ON and certainly don&rsquo;t need to have the alarm buzzing during the flight when everything is going well. So I had to come up with a way to control both devices with the transmitter.</p>
<p>The big innovation about this project is that <strong>both devices</strong> are controlled by the quadcopter transmitter using only a <strong>single</strong> channel.</p>
<p>As bonus points, with the help of the arduino, the piezo buzzer can be used as a &ldquo;cellphone ringtone player&rdquo; to ring the geekiest melodies&hellip;</p>
<h1 id="project-data">Project data</h1>
<h2 id="components-and-supplies">Components and Supplies</h2>
<p>All the hardware components required for this project are available  for purchase on eBay.</p>
<p class="pleasenote">
  Note that this project assumes that the arduino will be connected to a Remote Controlled (RC) 6-channels Receiver. This part for the project is then not listed as a &lsquo;required&rsquo; component.
</p>
<p>The material for this project is as follows:</p>
<table>
<thead>
<tr>
<th>Image</th>
<th>Description</th>
<th>Qty</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/Arduino-Nano-v3.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/Arduino-Nano-v3.jpg" alt="Arduino Nano v3"></a></td>
<td>Arduino Nano v3</td>
<td>1</td>
</tr>
<tr>
<td><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/Piezoelectric-Buzzer-Audible-Alarm-Sound-Buzzers.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/Piezoelectric-Buzzer-Audible-Alarm-Sound-Buzzers.jpg" alt="Piezoelectric Buzzer - Audible Alarm Sound Buzzers"></a></td>
<td>Piezoelectric Buzzer</td>
<td>1</td>
</tr>
<tr>
<td><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/10-Watt-LEDs.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/10-Watt-LEDs.jpg" alt="10 Watt LEDs"></a></td>
<td>10 Watt LEDs</td>
<td>1</td>
</tr>
<tr>
<td><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/MR16-12v-10w-LED-Driver.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/MR16-12v-10w-LED-Driver.jpg" alt="MR16 12v 10w LED Driver"></a></td>
<td>MR16 Constant Current LED Driver (12v 10w)</td>
<td>1</td>
</tr>
<tr>
<td><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/IRF630N-N-Channel-200V-9.3A-0.30-Ohm-TO-220AB-Power-Mosfet.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/IRF630N-N-Channel-200V-9.3A-0.30-Ohm-TO-220AB-Power-Mosfet.jpg" alt="IRF630N N-Channel 200V, 9.3A, 0.30-Ohm TO-220AB Power Mosfet"></a></td>
<td>N-Channel TO-220AB Power Mosfet<br /> (IRF630N, 200V, 9.3A, 0.30-Ohm)</td>
<td>2</td>
</tr>
<tr>
<td><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/20CM-Male-Servo-Extension-Lead-Wire-Cable.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/20CM-Male-Servo-Extension-Lead-Wire-Cable.jpg" alt="20CM Male to Male Servo Extension Lead Wire Cable"></a></td>
<td>20cm Male Servo Extension Lead Wire Cable</td>
<td>1</td>
</tr>
<tr>
<td><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/Female-JST-Battery-Connector.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/Female-JST-Battery-Connector.jpg" alt="Female JST Battery Connector"></a></td>
<td>Female JST battery connector</td>
<td>1</td>
</tr>
<tr>
<td><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/Single-Side-5x7cm-Prototyping-Stripboard.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/Single-Side-5x7cm-Prototyping-Stripboard.jpg" alt="Single Side 5x7cm Prototyping Stripboard"></a></td>
<td>Single Side 5x7cm Prototyping Stripboard</td>
<td>1</td>
</tr>
<tr>
<td><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/10k-resistor.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/10k-resistor.jpg" alt="10k resistor"></a></td>
<td>10k Ohm Resistor</td>
<td>2</td>
</tr>
<tr>
<td><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/Wire.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/Wire.jpg" alt="Wire"></a></td>
<td>Wires</td>
<td>1</td>
</tr>
<tr>
<td><a href="http://www.end2endzone.com/wp-content/uploads/2016/08/Wrapping-Foam.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/08/Wrapping-Foam.jpg" alt="Wrapping Foam"></a></td>
<td>Wrapping foam</td>
<td>1</td>
</tr>
<tr>
<td><a href="http://www.end2endzone.com/wp-content/uploads/2016/08/Wood-BBQ-Skewers.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/08/Wood-BBQ-Skewers.jpg" alt="Wood BBQ Skewers"></a></td>
<td>Wood BBQ Skewers</td>
<td>2</td>
</tr>
<tr>
<td><a href="http://www.end2endzone.com/wp-content/uploads/2016/03/CCPM-Servo-Tester.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/03/CCPM-Servo-Tester.jpg" alt="CCPM Servo Tester"></a></td>
<td>CCPM-Servo-Tester</td>
<td>1</td>
</tr>
</tbody>
</table>
<h3 id="mr16-constant-current-led-driver">MR16 Constant Current LED Driver</h3>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/MR16-12v-10w-LED-Driver.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/MR16-12v-10w-LED-Driver.jpg" alt="MR16 12v 10w LED Driver"></a></p>
<p>MR16 12v 10w LED Driver</p>
<p>The MR16 Constant Current LED Driver is used to drive the 10w LED. It can easily be found on eBay and light stores since the driver is used to power LED lamps which happens to use 10w LEDs.</p>
<p>The controller is not cheap but looks like the best logical choice. On a quadcopter, every grams counts and this driver is very light and it is the smallest form factor circuit that I could find.</p>
<p>I am not that much concerned about power efficiency of the driver since the project is to be mounted to a quadcopter. The small 10w LED is not significant when compared to the 4 brushless motors.</p>
<h3 id="n-channel-power-mosfet">N-Channel Power Mosfet</h3>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/IRF630N-N-Channel-200V-9.3A-0.30-Ohm-TO-220AB-Power-Mosfet.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/IRF630N-N-Channel-200V-9.3A-0.30-Ohm-TO-220AB-Power-Mosfet.jpg" alt="IRF630N N-Channel 200V, 9.3A, 0.30-Ohm TO-220AB Power Mosfet"></a></p>
<p>IRF630N N-Channel 200V, 9.3A, 0.30-Ohm TO-220AB Power Mosfet</p>
<p>My original design only required a single mosfet and was used as a switch to trigger the MR16 LED driver and a simple NPN Transistor (like the 2N2222A) which was also used as a switch to trigger the piezo buzzer. This setup was working fine on the arduino development board which provides 5 volts. However, once I connected the board to my 3S LiPo battery, which is 11.1 volts, the gate of the 2N2222A started leaking from collector to emitter without a signal sent to the base (in other words, the switch was always closed). The piezo buzzer started ringing without me understanding why.</p>
<p class="pleasenote">
  Please note that your wife may get mad at you if you let the piezo buzzer ring for too long. Better use higher rated transistor!
</p>
<p>I used the IRF630N mosfet for driving both the LED and the piezo buzzer. The mosfet is rated for much higher current and voltage (200V, 9.3A) for this scenario but it is relatively cheap and I had plenty of those at home.</p>
<h2 id="payload">Payload</h2>
<p>I didn&rsquo;t take the time to calculate the weight of each component individually. Anyway that would not be really helpful since I do not expect anyone to actually try to optimize the circuit by replacing some components by lightweight version.</p>
<p>The total weight of the package is 37.5 grams. This is calculated using a high precision scale and it includes everything that is required for using the controller in the field. In other words, it also includes the wrapping foam the BBQ sticks and wires.</p>
<h2 id="total-cost-of-the-project">Total cost of the project</h2>
<p>This project is really cheap and can be completed with less than 30$.</p>
<p>Here is the detailed price of each items:</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Link</th>
<th>Quantity</th>
<th>Total</th>
</tr>
</thead>
<tbody>
<tr>
<td>Arduino Nano v3</td>
<td><a href="http://www.ebay.ca/sch/i.html?LH_BIN=1&amp;_from=R40&amp;_sacat=0&amp;_nkw=arduino+nano+v3&amp;_sop=15">eBay</a></td>
<td>1</td>
<td>$3.17</td>
</tr>
<tr>
<td>Piezoelectric Buzzer</td>
<td><a href="http://www.ebay.ca/sch/i.html?LH_BIN=1&amp;_from=R40&amp;_sacat=0&amp;_nkw=95db+Piezoelectric+Buzzer&amp;_sop=15">eBay</a></td>
<td>1</td>
<td>$1.30</td>
</tr>
<tr>
<td>10 Watt LED</td>
<td><a href="http://www.ebay.ca/sch/i.html?LH_BIN=1&amp;_from=R40&amp;_sacat=0&amp;_nkw=10w+LED+cool+white&amp;_sop=15">eBay</a></td>
<td>1</td>
<td>$1.00</td>
</tr>
<tr>
<td>MR16 Constant Current LED Driver</td>
<td><a href="http://www.ebay.ca/sch/i.html?LH_BIN=1&amp;_from=R40&amp;_sacat=0&amp;_nkw=MR16+Constant+Current+LED+Driver&amp;_sop=15">eBay</a></td>
<td>1</td>
<td>$2.24</td>
</tr>
<tr>
<td>N-Channel TO-220AB Power Mosfet</td>
<td><a href="http://www.ebay.ca/sch/i.html?LH_BIN=1&amp;_from=R40&amp;_sacat=0&amp;_nkw=IRF630N+mosfet&amp;_sop=15">eBay</a></td>
<td>2</td>
<td>$3.52<sup>1</sup></td>
</tr>
<tr>
<td>Male Servo Extension Lead Wire Cable</td>
<td><a href="http://www.ebay.ca/sch/i.html?LH_BIN=1&amp;_from=R40&amp;_sacat=0&amp;_nkw=Male+Servo+Extension+Lead+Wire+Cable&amp;_sop=15">eBay</a></td>
<td>1</td>
<td>$1.00</td>
</tr>
<tr>
<td>Female JST battery connector</td>
<td><a href="http://www.ebay.ca/sch/i.html?LH_BIN=1&amp;_from=R40&amp;_sacat=0&amp;_nkw=Female+JST+battery+connector&amp;_sop=15">eBay</a></td>
<td>1</td>
<td>$1.00</td>
</tr>
<tr>
<td>Single Side 5x7cm Prototyping Stripboard</td>
<td><a href="http://www.ebay.ca/sch/i.html?LH_BIN=1&amp;_from=R40&amp;_sacat=0&amp;_nkw=Single+Side+5x7cm+Prototyping+Stripboard&amp;_sop=15">eBay</a></td>
<td>1</td>
<td>$4.56<sup>2</sup></td>
</tr>
<tr>
<td>10k Ohm Resistor</td>
<td><a href="http://www.ebay.ca/sch/i.html?LH_BIN=1&amp;_from=R40&amp;_sacat=0&amp;_nkw=10k+Ohm+Resistor&amp;_sop=15">eBay</a></td>
<td>2</td>
<td>$1.00<sup>3</sup></td>
</tr>
<tr>
<td>CCPM-Servo-Tester</td>
<td><a href="http://www.ebay.ca/sch/i.html?LH_BIN=1&amp;_from=R40&amp;_sacat=0&amp;_nkw=CCPM-Servo-Tester&amp;_sop=15">eBay</a></td>
<td>1</td>
<td>$1.61</td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ol>
<li>Bying 5 pieces is cheaper than buying 2 individual pieces.</li>
<li>Lowest price is for 2 pieces.</li>
<li>For a pack of 50 pieces.</li>
</ol>
<p>Total cost: $20.40</p>
<p class="pleasenote">
  Note that cost of usual items such as solder paste, soldering iron, multimeter and base material like wrapping foam is not included in the cost of the project.
</p>
<h2 id="preparation-time">Preparation time</h2>
<p>The whole project can be completed in 5 to 8  hours. This is actually a rough estimated time since I did not build a second controller for another quad that I had. The estimation assumes the following:</p>
<ul>
<li>You already have all required components. Most of the waiting about this project comes from the fact that all components are purchased from China and takes 4-5 weeks to arrive. However, once you have all materials, the project starts to build itself at a decent pace.</li>
<li>You have basic soldering skills. The duration of this project may change depending on how much you are comfortable with a soldering iron.</li>
<li>You are familiar with the arduino prototyping platform. This guide will not cover how to compile the code/libraries and upload it to the arduino. There are plenty of guides and tutorials on the internet that can help you on this matter.</li>
</ul>
<p>To make this project a reality, I had to invest much more time. Actually, from beginning to the end, it took somewhere between 50 to 80 hours. I had to learn new skills like basic electronics, designing circuits, using Fritzing software and the arduino platform but most of the time was spent on documenting and debugging the code!(there are still improvements, <a href="#Made_anything_differently">see below</a>).</p>
<p>I decided to post this project so that others may benefit from my experience. The project can be used as a proof of concept,  all issues that I encountered are already documented and the code for the project is released to the public.</p>
<h1 id="schematics">Schematics</h1>
<p>The following section shows the drawings and the schematics used by the controller.</p>
<h2 id="fritzing-files">Fritzing files</h2>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/10/fritzing_logo_new.png"><img src="http://www.end2endzone.com/wp-content/uploads/2016/10/fritzing_logo_new.png" alt="Fritzing - Open-Source Hardware Initiative Tool"></a></p>
<p>Fritzing - Open-Source Hardware Initiative Tool</p>
<p>All drawings and diagrams are build using <a href="http://fritzing.org/home/">Fritzing</a>¬†version 0.9.2b which is an open-source hardware initiative tool that allows developers to document their prototypes and share them with others. The application already features a huge parts library but there is no support for a <a href="#Components_and_Supplies">Generic Remote Controlled (RC) 6-Channels Receiver</a>¬†and for the <a href="#Components_and_Supplies">MR16 Constant Current LED Driver</a>.</p>
<p>The additional parts which are required for rendering the project are available for download:</p>
<ul>
<li><a href="http://www.end2endzone.com/download/2237/"> MR16 Constant Current LED Driver.fzpz</a></li>
<li><a href="http://www.end2endzone.com/download/2235/"> Generic 2.4Ghz RC 6ch Receiver (OCRA).fzpz</a></li>
<li><a href="http://www.end2endzone.com/download/2233/"> 3S 3600mAh Lipo Battery.fzpz</a></li>
</ul>
<p>The project files are also available for download. Click the following link to get the <em>Fritzing project files</em> for this project:</p>
<ul>
<li><a href="http://www.end2endzone.com/download/2240/"> DIY lost plane alarm finder and 10 watts LED visual aids for easy orientation.fzz</a></li>
</ul>
<h2 id="circuit-diagram">Circuit Diagram</h2>
<p>The following section shows the circuit diagram layout</p>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/Quad_Controller_schematics.png"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/Quad_Controller_schematics.png" alt="Quadcopter Controller Project - Schematics view"></a></p>
<p>Quadcopter Controller Project - Schematics view</p>
<h2 id="breadboard-layout">Breadboard Layout</h2>
<p>The following section shows a breadboard layout view of the circuit.</p>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/Quad_Controller_breadboard.png"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/Quad_Controller_breadboard.png" alt="Quadcopter Controller Project - Breadboard view"></a></p>
<p>Quadcopter Controller Project - Breadboard view</p>
<h1 id="code">Code</h1>
<p>The following section defines the required libraries for compiling the main arduino sketch available below.</p>
<h2 id="external-libraries">External libraries</h2>
<p>The code on the arduino requires multiple external arduino libraries. The following list shows all required software libraries and their related use as part of this project:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Version</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://www.end2endzone.com/softtimers-a-collection-of-software-timers-to-easily-compute-elapsed-time-since-an-event-occured/">SoftTimers</a>¬†<sup>5</sup></td>
<td>v1.1.219</td>
<td>Required for all computation and handling of the LED&rsquo;s ON and OFF times.</td>
</tr>
<tr>
<td><a href="http://www.end2endzone.com/rcreceiversignal-an-arduino-library-for-retreiving-the-rc-transmitter-value-from-an-rc-receiver-pulse/">RcReceiverSignal</a>¬†<sup>8</sup></td>
<td>v1.2.203</td>
<td>Required to read PWM signals sent<br /> from the RC Receiver.</td>
</tr>
<tr>
<td><a href="http://www.end2endzone.com/anyrtttl-a-feature-rich-arduino-library-for-playing-rtttl-melodies/">AnyRtttl</a>¬†<sup>7</sup></td>
<td>v2.1</td>
<td>Required to play RTTTL melodies data.</td>
</tr>
<tr>
<td><a href="http://github.com/GreyGnome/PinChangeInt">PinChangeInt</a></td>
<td>version 2402</td>
<td>RcReceiverSignal library has a dependency<br /> to PinChangeInt library.</td>
</tr>
<tr>
<td><a href="http://www.electricrcaircraftguy.com/2014/02/Timer2Counter-more-precise-Arduino-micros-function.html">eRCaGuy Timer2 Counter</a></td>
<td>version 20140709<br /> (last updated<br /> 9 July 2014)</td>
<td>Required to have a micros() replacement function<br /> which has a 1¬µs resolution instead of 4¬µs.</td>
</tr>
</tbody>
</table>
<h2 id="arduino-sketch">Arduino sketch</h2>
<p>Here is the brain of the project. Source code!</p>
<p>Click the following to download the example below:<br>
(download 
<a href="http://www.end2endzone.com/download/2263/" title="Version 1.0.240"> Quad Controller v1.0.240.ino</a>)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="ln">  1</span><span class="c1">//
</span><span class="ln">  2</span><span class="c1">//  QuadCtrl - Quadcopter Controller - v1.0 - 10/07/2016
</span><span class="ln">  3</span><span class="c1">//  Copyright (C) 2016 Antoine Beauchamp
</span><span class="ln">  4</span><span class="c1">//  The code &amp; updates for the library can be found on http://end2endzone.com
</span><span class="ln">  5</span><span class="c1">//
</span><span class="ln">  6</span><span class="c1">// AUTHOR/LICENSE:
</span><span class="ln">  7</span><span class="c1">//  This library is free software; you can redistribute it and/or
</span><span class="ln">  8</span><span class="c1">//  modify it under the terms of the GNU Lesser General Public
</span><span class="ln">  9</span><span class="c1">//  License as published by the Free Software Foundation; either
</span><span class="ln"> 10</span><span class="c1">//  version 3.0 of the License, or (at your option) any later version.
</span><span class="ln"> 11</span><span class="c1">//
</span><span class="ln"> 12</span><span class="c1">//  This library is distributed in the hope that it will be useful,
</span><span class="ln"> 13</span><span class="c1">//  but WITHOUT ANY WARRANTY; without even the implied warranty of
</span><span class="ln"> 14</span><span class="c1">//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
</span><span class="ln"> 15</span><span class="c1">//  Lesser General Public License (LGPL-3.0) for more details.
</span><span class="ln"> 16</span><span class="c1">//
</span><span class="ln"> 17</span><span class="c1">//  You should have received a copy of the GNU Lesser General Public
</span><span class="ln"> 18</span><span class="c1">//  License along with this library; if not, write to the Free Software
</span><span class="ln"> 19</span><span class="c1">//  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
</span><span class="ln"> 20</span><span class="c1">//
</span><span class="ln"> 21</span><span class="c1">// DISCLAIMER:
</span><span class="ln"> 22</span><span class="c1">//  This software is furnished &#34;as is&#34;, without technical support, and with no 
</span><span class="ln"> 23</span><span class="c1">//  warranty, express or implied, as to its usefulness for any purpose.
</span><span class="ln"> 24</span><span class="c1">//
</span><span class="ln"> 25</span><span class="c1">// PURPOSE:
</span><span class="ln"> 26</span><span class="c1">//  The following code implements Buzzer &amp; LED functionnalities to my 
</span><span class="ln"> 27</span><span class="c1">//  personnal quadcopter.
</span><span class="ln"> 28</span><span class="c1">//
</span><span class="ln"> 29</span><span class="c1">//  The buzzer is activated to play RTTTL melodies played before takeoff
</span><span class="ln"> 30</span><span class="c1">//  and after landing. The buzzer is also used to play a mayday distress
</span><span class="ln"> 31</span><span class="c1">//  signal that can be used to recover the quadcopter after an unexpected
</span><span class="ln"> 32</span><span class="c1">//  crash.
</span><span class="ln"> 33</span><span class="c1">//
</span><span class="ln"> 34</span><span class="c1">//  The front-facing 10w LED is used to know the orientation of the quadcopter
</span><span class="ln"> 35</span><span class="c1">//  from a far point of view. To prevent the LED from draining the battery,
</span><span class="ln"> 36</span><span class="c1">//  the LED is flashing at specific rates.
</span><span class="ln"> 37</span><span class="c1">//  The rates can be modulated from 40 positions varrying from always OFF
</span><span class="ln"> 38</span><span class="c1">//  to always ON in a 2 second cycle. ie: a rate of 24/40 (60%) turns the
</span><span class="ln"> 39</span><span class="c1">//  LED ON for 1200ms and OFF for 800ms.
</span><span class="ln"> 40</span><span class="c1">//
</span><span class="ln"> 41</span><span class="c1">//  Both functionalities are activated through my SPEKTRUM DX9
</span><span class="ln"> 42</span><span class="c1">//  transmitter using a rotary knob, a 2-position switch and a 3-position
</span><span class="ln"> 43</span><span class="c1">//  switch sending a signal to my Orange R620X DSMX2 receiver.
</span><span class="ln"> 44</span><span class="c1">//
</span><span class="ln"> 45</span><span class="c1">//  The receiver is connected to arduino pin 2 to read PWM signals sent
</span><span class="ln"> 46</span><span class="c1">//  by the receiver.
</span><span class="ln"> 47</span><span class="c1">//
</span><span class="ln"> 48</span><span class="c1">//  The code is indented to run on an arduino nano v3.
</span><span class="ln"> 49</span><span class="c1">//
</span><span class="ln"> 50</span><span class="c1">// HISTORY:
</span><span class="ln"> 51</span><span class="c1">// 10/07/2016 v1.0 - Initial release of QuadCtrl.
</span><span class="ln"> 52</span><span class="c1">//
</span><span class="ln"> 53</span><span class="c1">// ---------------------------------------------------------------------------
</span><span class="ln"> 54</span><span class="c1"></span>
<span class="ln"> 55</span>
<span class="ln"> 56</span>
<span class="ln"> 57</span><span class="cm">/*************************************************
</span><span class="ln"> 58</span><span class="cm"> * PinChangeInt code optimizations
</span><span class="ln"> 59</span><span class="cm"> *************************************************/</span>
<span class="ln"> 60</span><span class="c1">//http://www.benripley.com/diy/arduino/three-ways-to-read-a-pwm-signal-with-arduino/
</span><span class="ln"> 61</span><span class="c1">//https://github.com/GreyGnome/PinChangeInt/wiki/Usage
</span><span class="ln"> 62</span><span class="c1">//http://playground.arduino.cc/Learning/Pins
</span><span class="ln"> 63</span><span class="c1">//#define NO_PIN_STATE        // to indicate that you don&#39;t need the PCintPort::pinState
</span><span class="ln"> 64</span><span class="c1"></span><span class="cp">#define NO_PIN_NUMBER         </span><span class="c1">// to indicate that you don&#39;t need the PCintPort::arduinoPin
</span><span class="ln"> 65</span><span class="c1"></span><span class="cp">#define PINMODE               </span><span class="c1">// defines PCintPort::pinMode which is 
</span><span class="ln"> 66</span><span class="c1"></span><span class="cp">#define NO_PORTC_PINCHANGES   </span><span class="c1">// only port D pinchanges (see: http://playground.arduino.cc/Learning/Pins)
</span><span class="ln"> 67</span><span class="c1"></span><span class="cp">#define NO_PORTB_PINCHANGES   </span><span class="c1">// only port B pinchanges (see: http://playground.arduino.cc/Learning/Pins)
</span><span class="ln"> 68</span><span class="c1"></span>
<span class="ln"> 69</span><span class="c1">//required libraries
</span><span class="ln"> 70</span><span class="c1"></span>
<span class="ln"> 71</span><span class="c1">//Using SoftTimers v1.1.219
</span><span class="ln"> 72</span><span class="c1">//Required to calculate the LED&#39;s ON and OFF times.
</span><span class="ln"> 73</span><span class="c1">//Available at http://www.end2endzone.com/softtimers-a-collection-of-software-timers-to-easily-compute-elapsed-time-since-an-event-occured/
</span><span class="ln"> 74</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;SoftTimers.h&gt;</span><span class="cp">
</span><span class="ln"> 75</span><span class="cp"></span>
<span class="ln"> 76</span><span class="c1">//Using RcReceiverSignal v1.2.203
</span><span class="ln"> 77</span><span class="c1">//Required to read PWM signals sent from the RC Receiver.
</span><span class="ln"> 78</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;RcReceiverSignal.h&gt;</span><span class="cp">
</span><span class="ln"> 79</span><span class="cp"></span>
<span class="ln"> 80</span><span class="c1">//Using PinChangeInt version 2402
</span><span class="ln"> 81</span><span class="c1">//RcReceiverSignal library has a dependency to PinChangeInt library.
</span><span class="ln"> 82</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;PinChangeInt.h&gt;</span><span class="cp">
</span><span class="ln"> 83</span><span class="cp"></span>
<span class="ln"> 84</span><span class="c1">//Using eRCaGuy_Timer2_Counter version 20140709 (last updated 9 July 2014)
</span><span class="ln"> 85</span><span class="c1">//Required to have a micros() replacement function which has a 
</span><span class="ln"> 86</span><span class="c1">//1us resolution instead of 4usec.
</span><span class="ln"> 87</span><span class="c1">//For more information on this library, see the following:
</span><span class="ln"> 88</span><span class="c1">// http://electricrcaircraftguy.com/2014/02/Timer2Counter-more-precise-Arduino-micros-function.html
</span><span class="ln"> 89</span><span class="c1">// http://www.instructables.com/id/How-to-get-an-Arduino-micros-function-with-05us-pr/
</span><span class="ln"> 90</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;eRCaGuy_Timer2_Counter.h&gt;</span><span class="cp">
</span><span class="ln"> 91</span><span class="cp"></span>
<span class="ln"> 92</span><span class="c1">//Using AnyRtttl v2.1 - 06/05/2016
</span><span class="ln"> 93</span><span class="c1">//Required to play RTTTL data
</span><span class="ln"> 94</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;anyrtttl.h&gt;</span><span class="cp">
</span><span class="ln"> 95</span><span class="cp">#include</span> <span class="cpf">&lt;binrtttl.h&gt;</span><span class="cp">
</span><span class="ln"> 96</span><span class="cp">#include</span> <span class="cpf">&lt;pitches.h&gt;</span><span class="cp">
</span><span class="ln"> 97</span><span class="cp"></span>
<span class="ln"> 98</span><span class="c1">//project&#39;s constants
</span><span class="ln"> 99</span><span class="c1"></span><span class="cp">#define RECEIVER_AUX1_IN_PIN 2 </span><span class="c1">// we could choose any pin
</span><span class="ln">100</span><span class="c1"></span><span class="cp">#define LED_DEBUG_OUT_PIN 13
</span><span class="ln">101</span><span class="cp">#define LED_OUT_PIN 9
</span><span class="ln">102</span><span class="cp">#define BUZZER_OUT_PIN 8
</span><span class="ln">103</span><span class="cp">#define LED_FREQUENCY_LENGTH 1000 </span><span class="c1">//in ms
</span><span class="ln">104</span><span class="c1"></span><span class="cp">#define ANALOG_VALUE_MIN 0
</span><span class="ln">105</span><span class="cp">#define ANALOG_VALUE_MAX 39
</span><span class="ln">106</span><span class="cp">#define ANALOG_VALUE_THRESHOLD 3
</span><span class="ln">107</span><span class="cp">#define DISABLE_RTTTL_PLAYBACK false
</span><span class="ln">108</span><span class="cp"></span>
<span class="ln">109</span><span class="c1">//project&#39;s switches
</span><span class="ln">110</span><span class="c1">//#define ENABLE_SERIAL_OUTPUT
</span><span class="ln">111</span><span class="c1"></span>
<span class="ln">112</span><span class="n">DECLARE_RECEIVER_SIGNAL</span><span class="p">(</span><span class="n">receiver_aux1_handler</span><span class="p">);</span>
<span class="ln">113</span><span class="n">SoftTimer</span> <span class="n">onTimer</span><span class="p">;</span>
<span class="ln">114</span><span class="n">SoftTimer</span> <span class="n">offTimer</span><span class="p">;</span>
<span class="ln">115</span><span class="n">SoftTimer</span> <span class="n">melodyInhibit</span><span class="p">;</span> <span class="c1">//prevents to consecutive RTTTL melodies to play one after the other
</span><span class="ln">116</span><span class="c1"></span><span class="n">SoftTimer</span> <span class="n">alarmTimer</span><span class="p">;</span>
<span class="ln">117</span><span class="kt">uint16_t</span> <span class="n">ledOnTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//ms
</span><span class="ln">118</span><span class="c1"></span><span class="kt">uint16_t</span> <span class="n">ledOffTime</span> <span class="o">=</span> <span class="n">LED_FREQUENCY_LENGTH</span><span class="p">;</span> <span class="c1">//ms
</span><span class="ln">119</span><span class="c1"></span><span class="kt">bool</span> <span class="n">ledOn</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="ln">120</span><span class="kt">bool</span> <span class="n">alarmOverride</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>  <span class="c1">//controlled by a 2-position switch
</span><span class="ln">121</span><span class="c1"></span><span class="kt">uint8_t</span> <span class="n">playMelody</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>  <span class="c1">//controlled by a 3-position switch
</span><span class="ln">122</span><span class="c1"></span>
<span class="ln">123</span><span class="kr">inline</span> <span class="kt">int16_t</span> <span class="nf">clamp</span><span class="p">(</span><span class="k">const</span> <span class="kt">int16_t</span> <span class="o">&amp;</span> <span class="n">iMin</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int16_t</span> <span class="o">&amp;</span> <span class="n">iValue</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int16_t</span> <span class="o">&amp;</span> <span class="n">iMax</span><span class="p">)</span> <span class="p">{</span>
<span class="ln">124</span>  <span class="k">if</span> <span class="p">(</span><span class="n">iValue</span> <span class="o">&lt;</span> <span class="n">iMin</span><span class="p">)</span>
<span class="ln">125</span>    <span class="k">return</span> <span class="n">iMin</span><span class="p">;</span>
<span class="ln">126</span>  <span class="k">if</span> <span class="p">(</span><span class="n">iValue</span> <span class="o">&gt;</span> <span class="n">iMax</span><span class="p">)</span>
<span class="ln">127</span>    <span class="k">return</span> <span class="n">iMax</span><span class="p">;</span>
<span class="ln">128</span>  <span class="k">return</span> <span class="n">iValue</span><span class="p">;</span>
<span class="ln">129</span><span class="p">}</span>
<span class="ln">130</span>
<span class="ln">131</span><span class="cm">/*
</span><span class="ln">132</span><span class="cm"> * Desription:
</span><span class="ln">133</span><span class="cm"> *  Demultiplex the following from an RcReceiverSignal value:
</span><span class="ln">134</span><span class="cm"> *  - an analog knob value (which has a resolution of 40 steps, values from 0 to 39)
</span><span class="ln">135</span><span class="cm"> *  - a 2-position switch
</span><span class="ln">136</span><span class="cm"> *  - a 3-position switch
</span><span class="ln">137</span><span class="cm"> *  
</span><span class="ln">138</span><span class="cm"> *  Code sample from http://www.end2endzone.com/how-to-multiplex-rc-transmitter-switches-into-a-single-channel/#Decoding-2
</span><span class="ln">139</span><span class="cm"> *  
</span><span class="ln">140</span><span class="cm"> *  The following mixes must be used on a Spektrum DX9 to multiplex all switches into AUX1:
</span><span class="ln">141</span><span class="cm"> *  - RKnob &gt; AX1,   high=-74%, low=  0%, offset=-99%
</span><span class="ln">142</span><span class="cm"> *  - RKnob &gt; AX1,   high=  0%, low= 54%, offset=100%
</span><span class="ln">143</span><span class="cm"> *  - SwitchA &gt; AX1, high=  0%, low=-69%, offset=100%
</span><span class="ln">144</span><span class="cm"> *  - SwitchB &gt; AX1, high=  0%, low=-46%, offset=100%
</span><span class="ln">145</span><span class="cm"> *  
</span><span class="ln">146</span><span class="cm"> */</span>
<span class="ln">147</span><span class="kt">void</span> <span class="nf">demultiplexAnalog40_1x2Pos1x3Pos</span><span class="p">(</span><span class="k">const</span> <span class="kt">int16_t</span> <span class="o">&amp;</span> <span class="n">iSignal</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="o">&amp;</span> <span class="n">oAnalogA</span><span class="p">,</span> <span class="kt">bool</span> <span class="o">&amp;</span> <span class="n">oSwitch2</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="o">&amp;</span> <span class="n">oSwitch3</span><span class="p">)</span> <span class="p">{</span>
<span class="ln">148</span>  <span class="cp">#define setSwitches(effectiveMin,signal,effectiveMax,a,b) oAnalogA=clamp(effectiveMin,signal,effectiveMax) - (effectiveMin); oSwitch2=a; oSwitch3=b;
</span><span class="ln">149</span><span class="cp"></span>       <span class="k">if</span> <span class="p">(</span> <span class="o">-</span><span class="mi">150</span> <span class="o">&lt;=</span> <span class="n">iSignal</span> <span class="o">&amp;&amp;</span> <span class="n">iSignal</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">105</span> <span class="p">)</span> <span class="p">{</span> <span class="n">setSwitches</span><span class="p">(</span> <span class="o">-</span><span class="mi">147</span> <span class="p">,</span><span class="n">iSignal</span><span class="p">,</span> <span class="o">-</span><span class="mi">108</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">}</span>
<span class="ln">150</span>  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="o">-</span><span class="mi">104</span> <span class="o">&lt;=</span> <span class="n">iSignal</span> <span class="o">&amp;&amp;</span> <span class="n">iSignal</span> <span class="o">&lt;=</span>  <span class="o">-</span><span class="mi">59</span> <span class="p">)</span> <span class="p">{</span> <span class="n">setSwitches</span><span class="p">(</span> <span class="o">-</span><span class="mi">101</span> <span class="p">,</span><span class="n">iSignal</span><span class="p">,</span>  <span class="o">-</span><span class="mi">62</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">}</span>
<span class="ln">151</span>  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span>  <span class="o">-</span><span class="mi">58</span> <span class="o">&lt;=</span> <span class="n">iSignal</span> <span class="o">&amp;&amp;</span> <span class="n">iSignal</span> <span class="o">&lt;=</span>  <span class="o">-</span><span class="mi">13</span> <span class="p">)</span> <span class="p">{</span> <span class="n">setSwitches</span><span class="p">(</span>  <span class="o">-</span><span class="mi">55</span> <span class="p">,</span><span class="n">iSignal</span><span class="p">,</span>  <span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">}</span>
<span class="ln">152</span>  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span>  <span class="o">-</span><span class="mi">12</span> <span class="o">&lt;=</span> <span class="n">iSignal</span> <span class="o">&amp;&amp;</span> <span class="n">iSignal</span> <span class="o">&lt;=</span>   <span class="mi">33</span> <span class="p">)</span> <span class="p">{</span> <span class="n">setSwitches</span><span class="p">(</span>   <span class="o">-</span><span class="mi">9</span> <span class="p">,</span><span class="n">iSignal</span><span class="p">,</span>   <span class="mi">30</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">}</span>
<span class="ln">153</span>  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span>   <span class="mi">34</span> <span class="o">&lt;=</span> <span class="n">iSignal</span> <span class="o">&amp;&amp;</span> <span class="n">iSignal</span> <span class="o">&lt;=</span>   <span class="mi">79</span> <span class="p">)</span> <span class="p">{</span> <span class="n">setSwitches</span><span class="p">(</span>   <span class="mi">37</span> <span class="p">,</span><span class="n">iSignal</span><span class="p">,</span>   <span class="mi">76</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">}</span>
<span class="ln">154</span>  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span>   <span class="mi">80</span> <span class="o">&lt;=</span> <span class="n">iSignal</span> <span class="o">&amp;&amp;</span> <span class="n">iSignal</span> <span class="o">&lt;=</span>  <span class="mi">125</span> <span class="p">)</span> <span class="p">{</span> <span class="n">setSwitches</span><span class="p">(</span>   <span class="mi">83</span> <span class="p">,</span><span class="n">iSignal</span><span class="p">,</span>  <span class="mi">122</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">}</span>
<span class="ln">155</span>  <span class="k">else</span>
<span class="ln">156</span>  <span class="p">{</span>
<span class="ln">157</span>    <span class="n">setSwitches</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span> <span class="p">);</span>
<span class="ln">158</span>  <span class="p">}</span>
<span class="ln">159</span>  <span class="cp">#undef setSwitches
</span><span class="ln">160</span><span class="cp"></span><span class="p">}</span>
<span class="ln">161</span>
<span class="ln">162</span><span class="cm">/*
</span><span class="ln">163</span><span class="cm">void debugLED() {
</span><span class="ln">164</span><span class="cm">  while (true)
</span><span class="ln">165</span><span class="cm">  {
</span><span class="ln">166</span><span class="cm">    digitalWrite(LED_OUT_PIN, HIGH);
</span><span class="ln">167</span><span class="cm">    digitalWrite(LED_DEBUG_OUT_PIN, HIGH);
</span><span class="ln">168</span><span class="cm">    delay(1000);
</span><span class="ln">169</span><span class="cm">    digitalWrite(LED_OUT_PIN, LOW);
</span><span class="ln">170</span><span class="cm">    digitalWrite(LED_DEBUG_OUT_PIN, LOW);
</span><span class="ln">171</span><span class="cm">    delay(1000);
</span><span class="ln">172</span><span class="cm">  }
</span><span class="ln">173</span><span class="cm">}
</span><span class="ln">174</span><span class="cm">*/</span>
<span class="ln">175</span>
<span class="ln">176</span><span class="cp">#ifdef ENABLE_SERIAL_OUTPUT
</span><span class="ln">177</span><span class="cp"></span><span class="c1">//pretty print buffer
</span><span class="ln">178</span><span class="c1"></span><span class="kt">char</span> <span class="n">ppBuffer</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="ln">179</span>
<span class="ln">180</span><span class="kt">char</span> <span class="o">*</span> <span class="nf">prettyPrint</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint16_t</span> <span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span>
<span class="ln">181</span><span class="p">{</span>
<span class="ln">182</span>  <span class="n">sprintf</span><span class="p">(</span><span class="n">ppBuffer</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="ln">183</span>  <span class="k">return</span> <span class="n">ppBuffer</span><span class="p">;</span>
<span class="ln">184</span><span class="p">}</span>
<span class="ln">185</span><span class="kt">char</span> <span class="o">*</span> <span class="nf">prettyPrint</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int16_t</span> <span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span>
<span class="ln">186</span><span class="p">{</span>
<span class="ln">187</span>  <span class="n">sprintf</span><span class="p">(</span><span class="n">ppBuffer</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="ln">188</span>  <span class="k">return</span> <span class="n">ppBuffer</span><span class="p">;</span>
<span class="ln">189</span><span class="p">}</span>
<span class="ln">190</span><span class="cp">#endif
</span><span class="ln">191</span><span class="cp"></span>
<span class="ln">192</span><span class="cm">/*************************************************
</span><span class="ln">193</span><span class="cm"> * RTTTL Melodies
</span><span class="ln">194</span><span class="cm"> *************************************************/</span>
<span class="ln">195</span><span class="cp">#define NUM_RTTTL_MELODY 14
</span><span class="ln">196</span><span class="cp"></span><span class="k">const</span> <span class="kt">char</span> <span class="n">simpsons</span><span class="p">[]</span>           <span class="n">PROGMEM</span> <span class="o">=</span> <span class="s">&#34;simpsons:d=4,o=5,b=160:c.6,e6,f#6,8a6,g.6,e6,c6,8a,8f#,8f#,8f#,2g,8p,8p,8f#,8f#,8f#,8g,a#.,8c6,8c6,8c6,c6&#34;</span><span class="p">;</span>
<span class="ln">197</span><span class="k">const</span> <span class="kt">char</span> <span class="n">arkanoid</span><span class="p">[]</span>           <span class="n">PROGMEM</span> <span class="o">=</span> <span class="s">&#34;Arkanoid:d=4,o=5,b=140:8g6,16p,16g.6,2a#6,32p,8a6,8g6,8f6,8a6,2g6&#34;</span><span class="p">;</span>
<span class="ln">198</span><span class="k">const</span> <span class="kt">char</span> <span class="n">cocacola</span><span class="p">[]</span>           <span class="n">PROGMEM</span> <span class="o">=</span> <span class="s">&#34;Coca-cola:d=4,o=5,b=125:8f#6,8f#6,8f#6,8f#6,g6,8f#6,e6,8e6,8a6,f#6,d6,2p&#34;</span><span class="p">;</span>
<span class="ln">199</span><span class="k">const</span> <span class="kt">char</span> <span class="n">pacman</span><span class="p">[]</span>             <span class="n">PROGMEM</span> <span class="o">=</span> <span class="s">&#34;pacman:d=4,o=5,b=112:32b,32p,32b6,32p,32f#6,32p,32d#6,32p,32b6,32f#6,16p,16d#6,16p,32c6,32p,32c7,32p,32g6,32p,32e6,32p,32c7,32g6,16p,16e6,16p,32b,32p,32b6,32p,32f#6,32p,32d#6,32p,32b6,32f#6,16p,16d#6,16p,32d#6,32e6,32f6,32p,32f6,32f#6,32g6,32p,32g6,32g#6,32a6,32p,32b.6&#34;</span><span class="p">;</span>
<span class="ln">200</span><span class="k">const</span> <span class="kt">char</span> <span class="n">mario_short</span><span class="p">[]</span>        <span class="n">PROGMEM</span> <span class="o">=</span> <span class="s">&#34;smb_short:d=16,o=5,b=180:e.,e.,p.,e.,p.,c.,e.,p.,g.,4p,g.4&#34;</span><span class="p">;</span>
<span class="ln">201</span><span class="k">const</span> <span class="kt">char</span> <span class="n">mario_death</span><span class="p">[]</span>        <span class="n">PROGMEM</span> <span class="o">=</span> <span class="s">&#34;smbdeath:d=4,o=5,b=90:32c6,32c6,32c6,8p,16b,16f6,16p,16f6,16f.6,16e.6,16d6,16c6,16p,16e,16p,16c&#34;</span><span class="p">;</span>
<span class="ln">202</span><span class="k">const</span> <span class="kt">char</span> <span class="n">mario_flagpole</span><span class="p">[]</span>     <span class="n">PROGMEM</span> <span class="o">=</span> <span class="s">&#34;smbflagpole:d=32,o=6,b=112:f#.4,c.5,e.5,g.5,c.,e.,8g,8e,g#.4,c.5,d#.5,g#.5,c.,d#.,8g#,8d#,a#.4,d.5,f.5,a#.5,d.,f.,8a#,b.,b.,b.,4c7&#34;</span><span class="p">;</span>
<span class="ln">203</span><span class="k">const</span> <span class="kt">char</span> <span class="n">mario_gameover</span><span class="p">[]</span>     <span class="n">PROGMEM</span> <span class="o">=</span> <span class="s">&#34;smbgameover:d=8,o=4,b=180:16c.5,16p.,16p.,16g.,p.,e.,a,b,a,g#,a#,g#,16g.,16f.,g.&#34;</span><span class="p">;</span>
<span class="ln">204</span><span class="k">const</span> <span class="kt">char</span> <span class="n">mario_1up</span><span class="p">[]</span>          <span class="n">PROGMEM</span> <span class="o">=</span> <span class="s">&#34;smb1up:d=16,o=7,b=180:e.6,g.6,e.,c.,d.,g.&#34;</span><span class="p">;</span>
<span class="ln">205</span><span class="k">const</span> <span class="kt">char</span> <span class="n">starwars_cantina</span><span class="p">[]</span>   <span class="n">PROGMEM</span> <span class="o">=</span> <span class="s">&#34;SWCantina:d=4,o=5,b=250:8a,8p,8d6,8p,8a,8p,8d6,8p,8a,8d6,8p,8a,8p,8g#,a,8a,8g#,8a,g,8f#,8g,8f#,f.,8d.,16p,p.,8a,8p,8d6,8p,8a,8p,8d6,8p,8a,8d6,8p,8a,8p,8g#,8a,8p,8g,8p,g.,8f#,8g,8p,8c6,a#,a,g&#34;</span><span class="p">;</span>
<span class="ln">206</span><span class="k">const</span> <span class="kt">char</span> <span class="n">tetris</span><span class="p">[]</span>             <span class="n">PROGMEM</span> <span class="o">=</span> <span class="s">&#34;tetris:d=4,o=5,b=160:e6,8b,8c6,8d6,16e6,16d6,8c6,8b,a,8a,8c6,e6,8d6,8c6,b,8b,8c6,d6,e6,c6,a,2a,8p,d6,8f6,a6,8g6,8f6,e6,8e6,8c6,e6,8d6,8c6,b,8b,8c6,d6,e6,c6,a,a&#34;</span><span class="p">;</span>
<span class="ln">207</span><span class="k">const</span> <span class="kt">char</span> <span class="n">topgun</span><span class="p">[]</span>             <span class="n">PROGMEM</span> <span class="o">=</span> <span class="s">&#34;TopGun:d=4,o=4,b=31:32p,16c#,16g#,16g#,32f#,32f,32f#,32f,16d#,16d#,32c#,32d#,16f,32d#,32f,16f#,32f,32c#,16f,16d#&#34;</span><span class="p">;</span>
<span class="ln">208</span><span class="k">const</span> <span class="kt">char</span> <span class="n">backtothefuture</span><span class="p">[]</span>    <span class="n">PROGMEM</span> <span class="o">=</span> <span class="s">&#34;bttf:d=4,o=5,b=100:c#4,g#.4,8c#,b.4,16a#4,16g#4,8a#.4,8g#.4,8f#4,g#.4,16g#4,16g#4,2g#.4,c#,g#.,8c#6,b.,16a#,16g#,8a#.,8g#.,8f#,1g#&#34;</span><span class="p">;</span>
<span class="ln">209</span><span class="k">const</span> <span class="kt">char</span> <span class="n">bond</span><span class="p">[]</span>               <span class="n">PROGMEM</span> <span class="o">=</span> <span class="s">&#34;bond:d=4,o=5,b=125:8e,16f#,16f#,8f#,f#,8e,8e,8e,8e,16g,16g,8g,g,8f#,8f#,8f#,8e,16f#,16f#,8f#,f#,8e,8e,8e,8e,16g,16g,8g,g,8f#,8f#,8f#,8e,16f#,16f#,8f#,f#,8e,8e,8e,8e,16g,16g,8g,g,8f#,8f,8e,8e6,2d6,8p,8b,8a,2b&#34;</span><span class="p">;</span>
<span class="ln">210</span>
<span class="ln">211</span><span class="kt">void</span> <span class="nf">playRtttl</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">iPinNumber</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">iBuffer</span><span class="p">)</span> <span class="p">{</span>
<span class="ln">212</span>  <span class="c1">//are we allowed to play another melody ?
</span><span class="ln">213</span><span class="c1"></span>  <span class="c1">//is it too soon ?
</span><span class="ln">214</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="n">melodyInhibit</span><span class="p">.</span><span class="n">hasTimedOut</span><span class="p">()</span> <span class="o">||</span> <span class="n">melodyInhibit</span><span class="p">.</span><span class="n">getTimeOutTime</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
<span class="ln">215</span>  <span class="p">{</span>
<span class="ln">216</span>    <span class="c1">//fine play another melody
</span><span class="ln">217</span><span class="c1"></span>
<span class="ln">218</span>    <span class="c1">//disable interrupts. timer2 messes up with the tone() library
</span><span class="ln">219</span><span class="c1"></span>    <span class="n">noInterrupts</span><span class="p">();</span>
<span class="ln">220</span>    <span class="n">timer2</span><span class="p">.</span><span class="n">revert_to_normal</span><span class="p">();</span>
<span class="ln">221</span>    <span class="n">interrupts</span><span class="p">();</span>
<span class="ln">222</span>
<span class="ln">223</span>    <span class="c1">//play
</span><span class="ln">224</span><span class="c1"></span>    <span class="n">anyrtttl</span><span class="o">::</span><span class="n">blocking</span><span class="o">::</span><span class="n">playProgMem</span><span class="p">(</span><span class="n">iPinNumber</span><span class="p">,</span> <span class="n">iBuffer</span><span class="p">);</span>
<span class="ln">225</span>
<span class="ln">226</span>    <span class="c1">//enable interrupts. Configure timer2 again for 0.5us resolution.
</span><span class="ln">227</span><span class="c1"></span>    <span class="n">noInterrupts</span><span class="p">();</span>
<span class="ln">228</span>    <span class="n">timer2</span><span class="p">.</span><span class="n">setup</span><span class="p">();</span>
<span class="ln">229</span>    <span class="n">interrupts</span><span class="p">();</span>
<span class="ln">230</span>
<span class="ln">231</span>    <span class="c1">//disable RTTTL playback for 100ms to allow RcReceiverSignal to
</span><span class="ln">232</span><span class="c1"></span>    <span class="c1">//read the new update since the code was blocking during playback
</span><span class="ln">233</span><span class="c1"></span>    <span class="n">melodyInhibit</span><span class="p">.</span><span class="n">setTimeOutTime</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="ln">234</span>    <span class="n">melodyInhibit</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
<span class="ln">235</span>  <span class="p">}</span>
<span class="ln">236</span>  <span class="k">else</span>
<span class="ln">237</span>  <span class="p">{</span>
<span class="ln">238</span>    <span class="cp">#ifdef ENABLE_SERIAL_OUTPUT
</span><span class="ln">239</span><span class="cp"></span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&#34;Too soon for playing again. Please wait &#34;</span><span class="p">));</span>
<span class="ln">240</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">melodyInhibit</span><span class="p">.</span><span class="n">getRemainingTime</span><span class="p">());</span>
<span class="ln">241</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&#34;ms...&#34;</span><span class="p">));</span>
<span class="ln">242</span>    <span class="cp">#endif
</span><span class="ln">243</span><span class="cp"></span>  <span class="p">}</span>
<span class="ln">244</span><span class="p">}</span>
<span class="ln">245</span>
<span class="ln">246</span><span class="kt">uint32_t</span> <span class="nf">timer2GetCountWrapperFunction</span><span class="p">()</span> <span class="p">{</span>
<span class="ln">247</span>  <span class="k">return</span> <span class="n">timer2</span><span class="p">.</span><span class="n">get_count</span><span class="p">();</span>
<span class="ln">248</span><span class="p">}</span>
<span class="ln">249</span>
<span class="ln">250</span><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
<span class="ln">251</span>  <span class="n">pinMode</span><span class="p">(</span><span class="n">LED_OUT_PIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="ln">252</span>  <span class="n">pinMode</span><span class="p">(</span><span class="n">LED_DEBUG_OUT_PIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="ln">253</span>  <span class="n">pinMode</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="ln">254</span>
<span class="ln">255</span>  <span class="c1">//play booting melody
</span><span class="ln">256</span><span class="c1"></span>  <span class="n">playRtttl</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">arkanoid</span><span class="p">);</span>
<span class="ln">257</span>
<span class="ln">258</span>  <span class="c1">//configure Timer2
</span><span class="ln">259</span><span class="c1"></span>  <span class="n">timer2</span><span class="p">.</span><span class="n">setup</span><span class="p">();</span> <span class="c1">//this MUST be done before the other Timer2_Counter functions work; Note: since this messes up PWM outputs on pins 3 &amp; 11, as well as 
</span><span class="ln">260</span><span class="c1"></span>                  <span class="c1">//interferes with the tone() library (http://arduino.cc/en/reference/tone), you can always revert Timer2 back to normal by calling 
</span><span class="ln">261</span><span class="c1"></span>                  <span class="c1">//timer2.unsetup()
</span><span class="ln">262</span><span class="c1"></span>  
<span class="ln">263</span>  <span class="c1">//configure RcReceiverSignal with an external time counter
</span><span class="ln">264</span><span class="c1"></span>  <span class="c1">//eRCaGuy_Timer2_Counter lirary has 0.5us resolution.
</span><span class="ln">265</span><span class="c1"></span>  <span class="c1">//The counter value must be divided by 2 to convert from 0.5us steps to 1us steps
</span><span class="ln">266</span><span class="c1"></span>  <span class="c1">//which results in microseconds resolution.
</span><span class="ln">267</span><span class="c1"></span>  <span class="n">RcReceiverSignal</span><span class="o">::</span><span class="n">setExternalTimeCounter</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timer2GetCountWrapperFunction</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="ln">268</span>
<span class="ln">269</span>  <span class="c1">//link RcReceiverSignal to use PinChangeInt library
</span><span class="ln">270</span><span class="c1"></span>  <span class="n">RcReceiverSignal</span><span class="o">::</span><span class="n">setAttachInterruptFunction</span><span class="p">(</span><span class="o">&amp;</span><span class="n">PCintPort</span><span class="o">::</span><span class="n">attachInterrupt</span><span class="p">);</span>
<span class="ln">271</span>  <span class="n">RcReceiverSignal</span><span class="o">::</span><span class="n">setPinStatePointer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">PCintPort</span><span class="o">::</span><span class="n">pinState</span><span class="p">);</span>
<span class="ln">272</span>
<span class="ln">273</span>  <span class="c1">// if analog input pin 0 is unconnected, random analog
</span><span class="ln">274</span><span class="c1"></span>  <span class="c1">// noise will cause the call to randomSeed() to generate
</span><span class="ln">275</span><span class="c1"></span>  <span class="c1">// different seed numbers each time the sketch runs.
</span><span class="ln">276</span><span class="c1"></span>  <span class="c1">// randomSeed() will then shuffle the random function.
</span><span class="ln">277</span><span class="c1"></span>  <span class="kt">uint16_t</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="ln">278</span>  <span class="n">randomSeed</span><span class="p">(</span><span class="n">seed</span><span class="p">);</span>
<span class="ln">279</span>
<span class="ln">280</span>  <span class="c1">//allow the first RTTTL melody to be played
</span><span class="ln">281</span><span class="c1"></span>  <span class="n">melodyInhibit</span><span class="p">.</span><span class="n">setTimeOutTime</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="ln">282</span>
<span class="ln">283</span>  <span class="c1">//configure alarm loop count time
</span><span class="ln">284</span><span class="c1"></span>  <span class="n">alarmTimer</span><span class="p">.</span><span class="n">setTimeOutTime</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
<span class="ln">285</span>
<span class="ln">286</span>  <span class="cp">#ifdef ENABLE_SERIAL_OUTPUT
</span><span class="ln">287</span><span class="cp"></span>    <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
<span class="ln">288</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&#34;ready&#34;</span><span class="p">));</span>
<span class="ln">289</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&#34;seed=&#34;</span><span class="p">));</span>
<span class="ln">290</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">seed</span><span class="p">);</span>
<span class="ln">291</span>  <span class="cp">#endif
</span><span class="ln">292</span><span class="cp"></span>
<span class="ln">293</span>  <span class="n">receiver_aux1_handler_setup</span><span class="p">(</span><span class="n">RECEIVER_AUX1_IN_PIN</span><span class="p">);</span>
<span class="ln">294</span>
<span class="ln">295</span>  <span class="n">onTimer</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
<span class="ln">296</span><span class="p">}</span>
<span class="ln">297</span>
<span class="ln">298</span><span class="kt">void</span> <span class="nf">processBuzzerPinUpdate</span><span class="p">()</span>
<span class="ln">299</span><span class="p">{</span>
<span class="ln">300</span>  <span class="k">if</span> <span class="p">(</span><span class="n">alarmOverride</span><span class="p">)</span>
<span class="ln">301</span>  <span class="p">{</span>
<span class="ln">302</span>    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">alarmTimer</span><span class="p">.</span><span class="n">getLoopCount</span><span class="p">()</span> <span class="o">%</span> <span class="mi">29</span><span class="p">;</span>
<span class="ln">303</span>    <span class="kt">bool</span> <span class="n">pinHigh</span> <span class="o">=</span> <span class="p">(</span><span class="n">count</span> <span class="o">==</span>  <span class="mi">0</span> <span class="o">||</span> 
<span class="ln">304</span>                    <span class="n">count</span> <span class="o">==</span>  <span class="mi">2</span> <span class="o">||</span> 
<span class="ln">305</span>                    <span class="n">count</span> <span class="o">==</span>  <span class="mi">4</span> <span class="o">||</span> 
<span class="ln">306</span>                    <span class="n">count</span> <span class="o">==</span> <span class="mi">16</span> <span class="o">||</span> 
<span class="ln">307</span>                    <span class="n">count</span> <span class="o">==</span> <span class="mi">17</span> <span class="o">||</span> 
<span class="ln">308</span>                    <span class="n">count</span> <span class="o">==</span> <span class="mi">18</span> <span class="p">);</span>
<span class="ln">309</span>    <span class="k">if</span> <span class="p">(</span><span class="n">pinHigh</span><span class="p">)</span>
<span class="ln">310</span>      <span class="n">digitalWrite</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
<span class="ln">311</span>    <span class="k">else</span>
<span class="ln">312</span>      <span class="n">digitalWrite</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
<span class="ln">313</span>  <span class="p">}</span>
<span class="ln">314</span>  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">playMelody</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">//is 1 or 2
</span><span class="ln">315</span><span class="c1"></span>  <span class="p">{</span>
<span class="ln">316</span>    <span class="c1">//debuging mode: Temporary disable RTTTL playback
</span><span class="ln">317</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">DISABLE_RTTTL_PLAYBACK</span><span class="p">)</span>
<span class="ln">318</span>      <span class="k">return</span><span class="p">;</span>
<span class="ln">319</span>    
<span class="ln">320</span>    <span class="c1">// print a random number from 0 to NUM_RTTTL_MELODY-1
</span><span class="ln">321</span><span class="c1"></span>    <span class="kt">int32_t</span> <span class="n">melodyIndex</span> <span class="o">=</span> <span class="n">random</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NUM_RTTTL_MELODY</span><span class="p">);</span>
<span class="ln">322</span>
<span class="ln">323</span>    <span class="cp">#ifdef ENABLE_SERIAL_OUTPUT
</span><span class="ln">324</span><span class="cp"></span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&#34;melodyIndex=&#34;</span><span class="p">));</span>
<span class="ln">325</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">melodyIndex</span><span class="p">);</span>
<span class="ln">326</span>    <span class="cp">#endif
</span><span class="ln">327</span><span class="cp"></span>
<span class="ln">328</span>    <span class="k">switch</span><span class="p">(</span><span class="n">melodyIndex</span><span class="p">)</span>
<span class="ln">329</span>    <span class="p">{</span>
<span class="ln">330</span>    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
<span class="ln">331</span>      <span class="n">playRtttl</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">simpsons</span><span class="p">);</span>
<span class="ln">332</span>      <span class="k">break</span><span class="p">;</span>
<span class="ln">333</span>    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
<span class="ln">334</span>      <span class="n">playRtttl</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">arkanoid</span><span class="p">);</span>
<span class="ln">335</span>      <span class="k">break</span><span class="p">;</span>
<span class="ln">336</span>    <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
<span class="ln">337</span>      <span class="n">playRtttl</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">cocacola</span><span class="p">);</span>
<span class="ln">338</span>      <span class="k">break</span><span class="p">;</span>
<span class="ln">339</span>    <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
<span class="ln">340</span>      <span class="n">playRtttl</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">pacman</span><span class="p">);</span>
<span class="ln">341</span>      <span class="k">break</span><span class="p">;</span>
<span class="ln">342</span>    <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
<span class="ln">343</span>      <span class="n">playRtttl</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">mario_short</span><span class="p">);</span>
<span class="ln">344</span>      <span class="k">break</span><span class="p">;</span>
<span class="ln">345</span>    <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
<span class="ln">346</span>      <span class="n">playRtttl</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">mario_death</span><span class="p">);</span>
<span class="ln">347</span>      <span class="k">break</span><span class="p">;</span>
<span class="ln">348</span>    <span class="k">case</span> <span class="mi">6</span><span class="o">:</span>
<span class="ln">349</span>      <span class="n">playRtttl</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">mario_flagpole</span><span class="p">);</span>
<span class="ln">350</span>      <span class="k">break</span><span class="p">;</span>
<span class="ln">351</span>    <span class="k">case</span> <span class="mi">7</span><span class="o">:</span>
<span class="ln">352</span>      <span class="n">playRtttl</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">mario_gameover</span><span class="p">);</span>
<span class="ln">353</span>      <span class="k">break</span><span class="p">;</span>
<span class="ln">354</span>    <span class="k">case</span> <span class="mi">8</span><span class="o">:</span>
<span class="ln">355</span>      <span class="n">playRtttl</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">mario_1up</span><span class="p">);</span>
<span class="ln">356</span>      <span class="k">break</span><span class="p">;</span>
<span class="ln">357</span>    <span class="k">case</span> <span class="mi">9</span><span class="o">:</span>
<span class="ln">358</span>      <span class="n">playRtttl</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">starwars_cantina</span><span class="p">);</span>
<span class="ln">359</span>      <span class="k">break</span><span class="p">;</span>
<span class="ln">360</span>    <span class="k">case</span> <span class="mi">10</span><span class="o">:</span>
<span class="ln">361</span>      <span class="n">playRtttl</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">tetris</span><span class="p">);</span>
<span class="ln">362</span>      <span class="k">break</span><span class="p">;</span>
<span class="ln">363</span>    <span class="k">case</span> <span class="mi">11</span><span class="o">:</span>
<span class="ln">364</span>      <span class="n">playRtttl</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">topgun</span><span class="p">);</span>
<span class="ln">365</span>      <span class="k">break</span><span class="p">;</span>
<span class="ln">366</span>    <span class="k">case</span> <span class="mi">12</span><span class="o">:</span>
<span class="ln">367</span>      <span class="n">playRtttl</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">backtothefuture</span><span class="p">);</span>
<span class="ln">368</span>      <span class="k">break</span><span class="p">;</span>
<span class="ln">369</span>    <span class="k">case</span> <span class="mi">13</span><span class="o">:</span>
<span class="ln">370</span>      <span class="n">playRtttl</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">bond</span><span class="p">);</span>
<span class="ln">371</span>      <span class="k">break</span><span class="p">;</span>
<span class="ln">372</span>    <span class="k">default</span><span class="o">:</span>
<span class="ln">373</span>      <span class="cp">#ifdef ENABLE_SERIAL_OUTPUT
</span><span class="ln">374</span><span class="cp"></span>      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&#34;ERROR WITH RTTTL MELODY.&#34;</span><span class="p">));</span>
<span class="ln">375</span>      <span class="cp">#endif
</span><span class="ln">376</span><span class="cp"></span>      <span class="k">break</span><span class="p">;</span>
<span class="ln">377</span>    <span class="p">};</span>
<span class="ln">378</span>  <span class="p">}</span>
<span class="ln">379</span>  <span class="k">else</span>
<span class="ln">380</span>  <span class="p">{</span>
<span class="ln">381</span>    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">BUZZER_OUT_PIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
<span class="ln">382</span>  <span class="p">}</span>
<span class="ln">383</span><span class="p">}</span>
<span class="ln">384</span>
<span class="ln">385</span><span class="kt">void</span> <span class="nf">processAux1SignalChanged</span><span class="p">()</span>
<span class="ln">386</span><span class="p">{</span>
<span class="ln">387</span>  <span class="kt">uint16_t</span> <span class="n">pwnValue</span> <span class="o">=</span> <span class="n">receiver_aux1_handler</span><span class="p">.</span><span class="n">getPwmValue</span><span class="p">();</span>
<span class="ln">388</span>  <span class="n">RcReceiverSignal</span><span class="o">::</span><span class="n">VALUE</span> <span class="n">signalValue</span> <span class="o">=</span> <span class="n">receiver_aux1_handler</span><span class="p">.</span><span class="n">getDeviceSignalValue</span><span class="p">(</span><span class="n">SPEKTRUM_DX9_ORANGE_R620X</span><span class="p">,</span> <span class="n">pwnValue</span><span class="p">);</span>
<span class="ln">389</span>
<span class="ln">390</span>  <span class="kt">uint8_t</span> <span class="n">analogKnob</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln">391</span>  <span class="n">demultiplexAnalog40_1x2Pos1x3Pos</span><span class="p">(</span><span class="n">signalValue</span><span class="p">,</span> <span class="n">analogKnob</span><span class="p">,</span> <span class="n">alarmOverride</span><span class="p">,</span> <span class="n">playMelody</span><span class="p">);</span>
<span class="ln">392</span>
<span class="ln">393</span>  <span class="c1">//default to always OFF
</span><span class="ln">394</span><span class="c1"></span>  <span class="n">ledOnTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//ms
</span><span class="ln">395</span><span class="c1"></span>  <span class="n">ledOffTime</span> <span class="o">=</span> <span class="n">LED_FREQUENCY_LENGTH</span><span class="p">;</span> <span class="c1">//ms
</span><span class="ln">396</span><span class="c1"></span>
<span class="ln">397</span>  <span class="cm">/*
</span><span class="ln">398</span><span class="cm">   * Note:
</span><span class="ln">399</span><span class="cm">   *  Since the RcReceiverSignal may flicker a little (oscillate from 0 to 2),
</span><span class="ln">400</span><span class="cm">   *  the first 3 analog values must be considered OFF. This allows the pilot
</span><span class="ln">401</span><span class="cm">   *  to easily set the LED always OFF (without blimps).
</span><span class="ln">402</span><span class="cm">   *  
</span><span class="ln">403</span><span class="cm">   *  Also consider last 2 analog values as always ON. This allows the pilot
</span><span class="ln">404</span><span class="cm">   *  to easily set the LED always ON (without blimps).
</span><span class="ln">405</span><span class="cm">   */</span>
<span class="ln">406</span>  <span class="k">if</span> <span class="p">(</span><span class="n">analogKnob</span> <span class="o">&lt;</span> <span class="n">ANALOG_VALUE_THRESHOLD</span><span class="p">)</span>
<span class="ln">407</span>  <span class="p">{</span>
<span class="ln">408</span>    <span class="c1">//force always OFF
</span><span class="ln">409</span><span class="c1"></span>    <span class="n">analogKnob</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="ln">410</span>  <span class="p">}</span>
<span class="ln">411</span>  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">analogKnob</span> <span class="o">&gt;=</span> <span class="n">ANALOG_VALUE_MAX</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="ln">412</span>  <span class="p">{</span>
<span class="ln">413</span>    <span class="c1">//force always ON
</span><span class="ln">414</span><span class="c1"></span>    <span class="n">analogKnob</span> <span class="o">=</span> <span class="n">ANALOG_VALUE_MAX</span><span class="p">;</span>
<span class="ln">415</span>  <span class="p">}</span>
<span class="ln">416</span>
<span class="ln">417</span>  <span class="c1">//map signal value to an on-time and off-time
</span><span class="ln">418</span><span class="c1"></span>  <span class="n">ledOnTime</span> <span class="o">=</span> <span class="n">map</span><span class="p">(</span><span class="n">analogKnob</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ANALOG_VALUE_MAX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">LED_FREQUENCY_LENGTH</span><span class="p">);</span> <span class="c1">//ms
</span><span class="ln">419</span><span class="c1"></span>  <span class="n">ledOffTime</span> <span class="o">=</span> <span class="n">LED_FREQUENCY_LENGTH</span> <span class="o">-</span> <span class="n">ledOnTime</span><span class="p">;</span> <span class="c1">//ms
</span><span class="ln">420</span><span class="c1"></span>
<span class="ln">421</span>  <span class="c1">//update timers
</span><span class="ln">422</span><span class="c1"></span>  <span class="n">onTimer</span><span class="p">.</span><span class="n">setTimeOutTime</span><span class="p">(</span><span class="n">ledOnTime</span><span class="p">);</span>
<span class="ln">423</span>  <span class="n">offTimer</span><span class="p">.</span><span class="n">setTimeOutTime</span><span class="p">(</span><span class="n">ledOffTime</span><span class="p">);</span>
<span class="ln">424</span>
<span class="ln">425</span>  <span class="cp">#ifdef ENABLE_SERIAL_OUTPUT
</span><span class="ln">426</span><span class="cp"></span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&#34;signal=&#34;</span><span class="p">));</span>
<span class="ln">427</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">prettyPrint</span><span class="p">(</span><span class="s">&#34;%4d&#34;</span><span class="p">,</span> <span class="n">signalValue</span><span class="p">));</span>
<span class="ln">428</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&#34;% PWM=&#34;</span><span class="p">));</span>
<span class="ln">429</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">prettyPrint</span><span class="p">(</span><span class="s">&#34;%04d&#34;</span><span class="p">,</span> <span class="n">pwnValue</span><span class="p">));</span>
<span class="ln">430</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&#34; analog=&#34;</span><span class="p">));</span>
<span class="ln">431</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">prettyPrint</span><span class="p">(</span><span class="s">&#34;%02d&#34;</span><span class="p">,</span> <span class="n">analogKnob</span><span class="p">));</span>
<span class="ln">432</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&#34; buzzerOverride=&#34;</span><span class="p">));</span>
<span class="ln">433</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">buzzerOverride</span><span class="p">);</span>
<span class="ln">434</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&#34; playMelody=&#34;</span><span class="p">));</span>
<span class="ln">435</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">playMelody</span><span class="p">);</span>
<span class="ln">436</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&#34; ON:&#34;</span><span class="p">));</span>
<span class="ln">437</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">prettyPrint</span><span class="p">(</span><span class="s">&#34;%04d&#34;</span><span class="p">,</span> <span class="n">ledOnTime</span><span class="p">));</span>
<span class="ln">438</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&#34; OFF:&#34;</span><span class="p">));</span>
<span class="ln">439</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">prettyPrint</span><span class="p">(</span><span class="s">&#34;%04d&#34;</span><span class="p">,</span> <span class="n">ledOffTime</span><span class="p">));</span>
<span class="ln">440</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
<span class="ln">441</span>  <span class="cp">#endif
</span><span class="ln">442</span><span class="cp"></span><span class="p">}</span>
<span class="ln">443</span>
<span class="ln">444</span><span class="kt">void</span> <span class="nf">processLedPinUpdate</span><span class="p">()</span>
<span class="ln">445</span><span class="p">{</span>
<span class="ln">446</span>  <span class="k">if</span> <span class="p">(</span><span class="n">ledOn</span><span class="p">)</span>
<span class="ln">447</span>  <span class="p">{</span>
<span class="ln">448</span>    <span class="c1">//led is ON
</span><span class="ln">449</span><span class="c1"></span>
<span class="ln">450</span>    <span class="c1">//should it be turned OFF ?
</span><span class="ln">451</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">onTimer</span><span class="p">.</span><span class="n">hasTimedOut</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">offTimer</span><span class="p">.</span><span class="n">getTimeOutTime</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="ln">452</span>    <span class="p">{</span>
<span class="ln">453</span>      <span class="c1">//time to turn OFF the LED
</span><span class="ln">454</span><span class="c1"></span>      <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_OUT_PIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
<span class="ln">455</span>      <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_DEBUG_OUT_PIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
<span class="ln">456</span>      <span class="n">ledOn</span> <span class="o">=</span> <span class="o">!</span><span class="n">ledOn</span><span class="p">;</span>
<span class="ln">457</span>      <span class="n">offTimer</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
<span class="ln">458</span>    <span class="p">}</span>
<span class="ln">459</span>  <span class="p">}</span>
<span class="ln">460</span>  <span class="k">else</span>
<span class="ln">461</span>  <span class="p">{</span>
<span class="ln">462</span>    <span class="c1">//led is OFF
</span><span class="ln">463</span><span class="c1"></span>
<span class="ln">464</span>    <span class="c1">//should it be turned ON ?
</span><span class="ln">465</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">offTimer</span><span class="p">.</span><span class="n">hasTimedOut</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">onTimer</span><span class="p">.</span><span class="n">getTimeOutTime</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="ln">466</span>    <span class="p">{</span>
<span class="ln">467</span>      <span class="c1">//time to turn ON the LED
</span><span class="ln">468</span><span class="c1"></span>      <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_OUT_PIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
<span class="ln">469</span>      <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_DEBUG_OUT_PIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
<span class="ln">470</span>      <span class="n">ledOn</span> <span class="o">=</span> <span class="o">!</span><span class="n">ledOn</span><span class="p">;</span>
<span class="ln">471</span>      <span class="n">onTimer</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
<span class="ln">472</span>    <span class="p">}</span>
<span class="ln">473</span>  <span class="p">}</span>
<span class="ln">474</span><span class="p">}</span>
<span class="ln">475</span>
<span class="ln">476</span><span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
<span class="ln">477</span>  <span class="c1">//detect when the receiver AUX1 value has changed
</span><span class="ln">478</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="n">receiver_aux1_handler</span><span class="p">.</span><span class="n">hasChanged</span><span class="p">())</span>
<span class="ln">479</span>  <span class="p">{</span>
<span class="ln">480</span>    <span class="n">processAux1SignalChanged</span><span class="p">();</span>
<span class="ln">481</span>  <span class="p">}</span>
<span class="ln">482</span>
<span class="ln">483</span>  <span class="c1">//check timers if required to toggle
</span><span class="ln">484</span><span class="c1"></span>  <span class="n">processLedPinUpdate</span><span class="p">();</span>
<span class="ln">485</span>
<span class="ln">486</span>  <span class="c1">//update buzzer
</span><span class="ln">487</span><span class="c1"></span>  <span class="n">processBuzzerPinUpdate</span><span class="p">();</span>
<span class="ln">488</span><span class="p">}</span>
</code></pre></div>
<h1 id="building-steps">Building steps</h1>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/10/Building-steps.png"><img src="http://www.end2endzone.com/wp-content/uploads/2016/10/Building-steps.png" alt="building-steps"></a></p>
<p>The following section explains all the different steps on how to build my DIY quadcopter visual aids controller.</p>
<h2 id="install-code-on-arduino">Install code on arduino</h2>
<p>Before attempting run the given code on the arduino, you must first install the required libraries. Please follow the <a href="http://www.arduino.cc/en/Guide/Libraries#toc2">How to Install a Library</a> guide available on the arduino web site.</p>
<p>Download links for required libraries are available in the <a href="#External_libraries">External Libraries</a> or <a href="#References">References</a> sections.</p>
<p>Upload the main arduino sketch to the arduino and proceed with the next step.</p>
<h2 id="setup-transmitter-tx-mixes">Setup transmitter (Tx) mixes</h2>
<p>As explained <a href="#Microcontroller">above</a>,  this project innovation relies on the fact that <strong>both devices</strong> are controlled by the quadcopter transmitter using only a <strong>single channel</strong>. This is achieved by configuring custom mixes on the transmitter.</p>
<p>To know more about how mixes can be used to control more than one device with the help of a microcontroller, read the following article:¬†<a href="/how-to-multiplex-rc-transmitter-switches-into-a-single-channel/">How to multiplex RC Transmitter switches into a single channel</a>.</p>
<p>As a reference, here are the mixes that I use for my Spektrum DX9 transmitter:</p>
<table class="generictable" border="0" cellspacing="0" cellpadding="0">
  <tr class="headerrow">
    <td style="width: 240px;" colspan="5" width="220">AUX1 Mix info</td>
    <td style="width: 80px;" colspan="3" width="80">Mix Output</td>
  </tr>
  <tr class="headerrow">
    <td>Number</td>
    <td>Switch</td>
    <td>High</td>
    <td>Low</td>
    <td>Offset</td>
    <td></td>
    <td>1</td>
    <td>2</td>
  </tr>
  <tr>
    <td></td>
    <td>Right knob</td>
    <td>-74</td>
    <td></td>
    <td>-99</td>
    <td>-147</td>
    <td>-73</td>
    <td></td>
  </tr>
  <tr>
    <td>1</td>
    <td>Right knob</td>
    <td></td>
    <td>54</td>
    <td>100</td>
    <td></td>
    <td>-54</td>
    <td>-108</td>
  </tr>
  <tr>
    <td colspan="5"></td>
    <td style="background-color: #f7f497;">-147</td>
    <td style="background-color: #f7f497;">-127</td>
    <td style="background-color: #f7f497;">-108</td>
  </tr>
  <tr>
    <td>2</td>
    <td>H</td>
    <td></td>
    <td>-69</td>
    <td>100</td>
    <td></td>
    <td>-</td>
    <td>138</td>
  </tr>
  <tr>
    <td>3</td>
    <td>G</td>
    <td></td>
    <td>-46</td>
    <td>100</td>
    <td></td>
    <td>46</td>
    <td>92</td>
  </tr>
</table>
<p class="pleasenote">
  Note that the following mixes must match the <a href="#Arduino_sketch">demultiplexing  code</a>¬†running on the arduino. If you do not use the code &ldquo;as is&rdquo;, then you must also adjust your transmitter mixes to reflect the change.
</p>
<h2 id="build-a-prototype">Build a prototype</h2>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/DIY-Quadcopter-lost-plane-alarm-finder-and-10w-LED-visual-aids-Prototype.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/DIY-Quadcopter-lost-plane-alarm-finder-and-10w-LED-visual-aids-Prototype.jpg" alt="DIY Quadcopter lost plane alarm finder and 10w LED visual aids Prototype"></a></p>
<p>DIY Quadcopter lost plane alarm finder and 10w LED visual aids Prototype</p>
<p>The purpose of these steps is to evaluate the feasibility of the project by implementing a smaller scale of the project as a proof of concept even though that at this point you should already know that the project is viable since I already completed all steps and the controller is actually running on my personal quadcopter.</p>
<h3 id="test-the-code">Test the code</h3>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/10/QuadCtrl-Arduino-IDE-transparency.png"><img src="http://www.end2endzone.com/wp-content/uploads/2016/10/QuadCtrl-Arduino-IDE-transparency.png" alt="QuadCtrl - Testing the code in Arduino IDE"></a></p>
<p>QuadCtrl - Testing the code in Arduino IDE</p>
<p>The purpose of this step is to quickly identify issue with the code as no other parts (besides the arduino itself) of the final circuit is used. Code issues are the one that should be addressed first. This step confirms that the arduino is able to read an arbitrary PWM signal and process it.</p>
<p>Build the circuit as showed by the picture above. For reference, the yellow and blue wires matches the blue and orange wire of the breadboard layout. These wires are connected to pins which drives low LEDs instead of high current mosfets. The prototype uses a simple CCPM Servo Tester for emulating the 6-ch receiver. In this configuration, the red LED matches the 10W front LED and the green LED matches the buzzing state.</p>
<p>Power the arduino using USB power. By changing the position of the CCPM Servo tester potentiometer, you should observe different behavior of each LEDs for each position of CCPM tester.</p>
<p class="pleasenote">
  Note that since the code is already debugged, I do not expect anything to go wrong and things should be addressed easily. If you do observe issues, please verify your connections or the version used by each library dependencies.
</p>
<h3 id="txrx-prototype-integration">Tx/Rx prototype integration</h3>
<p>For a greater testing, connect your receiver and use your transmitter to change the PWM signal sent to the microcontroller.</p>
<p>This step verifies the quality (or precision of the signal) of the transmitter/receiver pair. It also helps validating that you configured the right mixes in your transmitter to independently control the LED and the buzzer.</p>
<h3 id="test-each-component-optional">Test each component (optional)</h3>
<p>Now that you know that the code is working as expected, you may want to test each components before <a href="#Solderingcomponents_on_thestripboard">soldering them</a> on the breadboard.</p>
<p>The final step is to integrate all real components to the breadboard prototype and use external 12v power supply (to mimic a 3S LiPo battery).</p>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/07/Quad_Controller_breadboard.png"><img src="http://www.end2endzone.com/wp-content/uploads/2016/07/Quad_Controller_breadboard.png" alt="Quadcopter Controller Project - Breadboard view"></a></p>
<p>Complete the actual circuit as defined in <a href="#Breadboard_Layout">Breadboard Layout</a>¬†section.</p>
<h2 id="solder-components">Solder components</h2>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/10/IMG_4566.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/10/IMG_4566.jpg" alt="QuadCtrl - Soldering components to the stripboard"></a></p>
<p>QuadCtrl - Soldering components to the stripboard</p>
<p>Define the position of every components on the prototyping stripboard. You should have enough room for all components and if you plan correctly, you may still have space left and be able to cut 1 or 2 cm from the sides to save additional size and weight.</p>
<p>Note that both mosfet do not require a heat sink. However, you may want to fold both mosfet so that the height of the total package is as low as possible so that it may fit properly inside a small cavity of the quadcopter.</p>
<p>Position the arduino&rsquo;s USB port facing outside so that when you need to update the software, you can simply connect the package to a computer without having to disassemble or disconnect the unit from the quadcopter.</p>
<p>For the same reason, solder the male servo extension lead and the JST battery connector to the other side since those will require to be as close as possible to the quadcopter&rsquo;s controller and battery.</p>
<p>Solder each component carefully following the schematics and head to the final step.</p>
<h2 id="secure-the-unit-on-the-quadcopter">Secure the unit on the quadcopter</h2>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/10/IMG_4557.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/10/IMG_4557.jpg" alt="QuadCtrl - Securing components with wrapping foam"></a></p>
<p>QuadCtrl - Securing components with wrapping foam</p>
<p>Once everything is ready for flight, attach the package on the quadcopter. Connect JST battery connector and each signal wire cable.</p>
<p>Since I was planning on removing the device for maintenance, I didn&rsquo;t used glue (or anything permanent) for securing the package to the frame. Instead I used zip ties which are used for both wrapping the foam around the stripboard and attaching to the frame&rsquo;s front grooves.</p>
<p>I also used zip ties to attach the wood BBQ skewers to the pre-drilled holes in the fuselage.</p>
<p>For best result, position the 10w LED below the propeller&rsquo;s wind blast. This will greatly increase the lifespan of the LED since it will always be properly cooled while turned on.</p>
<h2 id="final-result">Final Result</h2>
<p>Here is the final result:</p>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/08/Arduino-Quadcopter-Controler-final.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/08/Arduino-Quadcopter-Controler-final.jpg" alt="Arduino Quadcopter LED & Buzzer Controler (final)"></a></p>
<p>Arduino Quadcopter LED &amp; Buzzer Controler (final)</p>
<p><a href="http://www.end2endzone.com/wp-content/uploads/2016/08/Arduino-Quadcopter-Controler-final-close-up.jpg"><img src="http://www.end2endzone.com/wp-content/uploads/2016/08/Arduino-Quadcopter-Controler-final-close-up.jpg" alt="Arduino Quadcopter LED & Buzzer Controler (final) - Close Up"></a></p>
<p>Arduino Quadcopter LED &amp; Buzzer Controler (final) - Close Up</p>
<h1 id="made-anything-differently">Made anything differently?</h1>
<p>The features of the device are fulfilling the main objectives and there is no actual need to change anything. However, there are lots of aspect of the design that could be improved. After completing this project, I though of multiple ideas that could bring the design to a higher quality level.</p>
<p>At the beginning of the project, I was not much concerned about weight since I was evaluating the feasibility of the project and I didn&rsquo;t design the device to be something that would actually be flying. Now that it is completed, I would like to put more effort trying to reduce the total weight.</p>
<p>Here are most aspects that I would like to improve:</p>
<h2 id="better-signal-wires">Better signal wires</h2>
<p>Signal wires could be much improved.</p>
<p>First, they are way too big. The wires for the receiver signal between the 6-ch receiver (Rx) and the arduino could be made smaller. Only a small current is used to carry the signal so there is no need for not using the smallest wires available.</p>
<p>Second, not all wires are actually used. At the beginning of the design, I though of using the arduino to read multiple channels. In the picture above, the red and blue wires were designed to read 2 more PWM signals which would make the arduino able to decode 3 different channels. The blue and red wires are wasted grams I could save.</p>
<p>Finally, the length of the wires is 3-4 times longer than they actually need. When I was prototyping, it was actually convenient to have longer cable that could connect the receiver but once the unit is attached to the quadcopter, the device is almost next to the receiver and the need for longer wires is not much required anymore. The same also applies for the LED wires which had to be folded many times because they were too long.</p>
<h2 id="other-led-options">Other LED options?</h2>
<p>I still doubt that a single super strong LED is the way to go. In the near future, I might consider having multiple on-board middle-range LED and I am curious to see if multiple LEDs would produce more lumens than a single one. In the idea, having 2 or 3 smaller LED may make the whole thing more visible at greater distance. I may investigate other LED options which offers a better watt-to-lumens ratio.</p>
<p>If I ever choose to go with 2 or 3 smaller LED instead of a single super strong LED, I may also get rid of the current limiting circuit. The circuit is not particularly heavy but using smaller LED (which consumes less power), would allow me to replace the circuit by smaller/lighter resistance connected to each LED. I know that each resistance might not be super efficient (lots of heat dissipation) but it is negligible when compared to the enormous amount of energy consumed by the motors. A linear voltage regulator like the <a href="https://www.google.ca/search?q=lm317&amp;source=lnms&amp;tbm=isch">LM317</a> might also simplify the circuit and prevent too much heat dissipation.</p>
<h2 id="smaller-form-factor">Smaller form factor</h2>
<p>Getting rid of the stripboard would also be in my plans. Now that I know the whole circuit does not required too much connections, I am now thinking of completely removing the stripboard. This would require to hot glue both the mosfets and the current limiting circuit directly to the arduino. If done properly, the amount of hot glue required should be lighter than the stripboard.</p>
<p>At the same time, the device would be smaller which could make it usable on other platforms like ones with a hard shell cover.</p>
<h2 id="signal-demultiplexing-nessesary">Signal (de)multiplexing nessesary?</h2>
<p>Short answer, no.</p>
<p>Actually, I do not require to have an on-board arduino on the quad. There was no actual need to implement signal multiplexing and demultiplexing. To get the same functionality, I could have simply used an 8-channels receiver and the need for multiplexing/demultiplexing would be gone.</p>
<p>The main reason for this project was fun. <strong><em>&lsquo;All work and no play makes Antoine a dull boy&rsquo;</em></strong>. The project turned out more complicated than I first through and I had to invest a lot of my free time to code, test and to make it up to this point. Without the &lsquo;fun&rsquo; part, this project would never went further than ideas on a sheet of paper. If I ever have to rebuild this project, the fun part would still be the first and primary goal of the project!</p>
<h2 id="modular-design">Modular design</h2>
<p>For maintainability, portability and reusability reasons, it might be interesting to subdivide the device into modules (smaller reusable parts).</p>
<p>For instance the demultiplexor could be a perfect candidate for reusability. It could be reused on other platforms like airplanes to control non-critical flight accessories like landing lights where front, wings and tail lights could be controlled by a single channel.</p>
<p>The LED and buzzer could also be made into modules. Each or both could be modified to be directly connected to a dedicated channel on the receiver. If I ever upgrade the quadcopter to a 8-channels (or more) receiver, I could still use the LED and the buzzer without requiring the demultiplexor part.</p>
<h1 id="references">References</h1>
<p>Here is the list of all sub-articles that made this project a reality:</p>
<p>Documentation:</p>
<ol>
<li><a href="http://www.end2endzone.com/how-to-multiplex-rc-transmitter-switches-into-a-single-channel/">How to multiplex RC Transmitter switches into a single channel</a>.</li>
<li><a href="http://www.end2endzone.com/mapping-rc-transmitter-pwm-signal-to-actual-transmitter-values/">Mapping RC Transmitter PWM signal to actual transmitter values</a>.</li>
<li><a href="http://www.end2endzone.com/demystifying-rc-transmitter-mixing/">Demystifying RC Transmitter Mixing</a>.</li>
<li><a href="http://www.end2endzone.com/rc-transmitter-mix-calculator/">RC Transmitter Mix Calculator</a>.</li>
</ol>
<p>Arduino libraries:</p>
<ul>
<li><a href="http://www.end2endzone.com/softtimers-a-collection-of-software-timers-to-easily-compute-elapsed-time-since-an-event-occured/">SoftTimers ‚Äì A collection of software timers to easily compute elapsed time since an event occurred</a>.
<ol>
<li><a href="http://www.end2endzone.com/librtttl-a-c-library-with-ui-for-compressingoptimizing-the-rtttl-audio-format/">libRtttl ‚Äì A c++ library (with UI) for compressing/optimizing the RTTTL audio format</a>.</li>
<li><a href="http://www.end2endzone.com/anyrtttl-a-feature-rich-arduino-library-for-playing-rtttl-melodies/">AnyRtttl ‚Äì A feature rich arduino library for playing RTTTL melodies</a>.</li>
<li><a href="http://www.end2endzone.com/rcreceiversignal-an-arduino-library-for-retreiving-the-rc-transmitter-value-from-an-rc-receiver-pulse/">RcReceiverSignal: an arduino library for retrieving the RC Transmitter value from an RC Receiver pulse</a>.</li>
</ol>
</li>
</ul>
<h1 id="notes">Notes</h1>
<p>none</p>
      </div>
      <footer>
        <div class="stats">
  
    <ul class="categories">
      
        
          <li><a class="article-terms-link" href="/categories/model-aeronautics/">Model Aeronautics</a></li>
        
      
    </ul>
  
  
    <ul class="tags">
      
        
          <li><a class="article-terms-link" href="/tags/arduino/">arduino</a></li>
        
          <li><a class="article-terms-link" href="/tags/diy/">diy</a></li>
        
          <li><a class="article-terms-link" href="/tags/english/">english</a></li>
        
          <li><a class="article-terms-link" href="/tags/open-source/">open source</a></li>
        
          <li><a class="article-terms-link" href="/tags/rc/">RC</a></li>
        
      
    </ul>
  
</div>

      </footer>
    </div>
    
      
  <div class='post'>
    
    <div>
      <h2 id='say-something'>Say Something</h2>
        <form id='comment-form' class='new-comment' method='POST'>
          
          <h3 class='reply-notice hidden'>
            <span class='reply-name'></span>
            <a class='reply-close-btn button'><i class='fas fa-times'></i></a>
          </h3>

          
          <input type='hidden' name='options[entryId]' value='0b11642884f961c0db88d28e1779b039'>
          <input type='hidden' name='fields[replyThread]' value=''>
          <input type='hidden' name='fields[replyID]' value=''>
          <input type='hidden' name='fields[replyName]' value=''>

          
          <input required name='fields[name]' type='text' placeholder='Your Name'>
          <input name='fields[website]' type='text' placeholder='Your Website'>
          <input required name='fields[email]' type='email' placeholder='Your Email'>
          <textarea required name='fields[body]' placeholder='Your Message' rows='10'></textarea>

          
          

          
          <div class='submit-notice'>
            <strong class='submit-notice-text submit-success hidden'>Thanks for your comment! It will be shown on the site once it has been approved.</strong>
            <strong class='submit-notice-text submit-failed hidden'>Sorry, there was an error with your submission. Please make sure all required fields have been completed and try again.</strong>
          </div>

          
          <button type='button' id="comment-form-submit" class='button'>Submit</button>
          <button type='button' id="comment-form-submitted" class='hidden button' disabled>Submitted</button>
          <button type='reset' id="comment-form-reset" class='button'>Reset</button>
        </form>
    </div>

    
    <div class='comments-container'>
      <h2>Comments</h2>
    </div>
  </div>


    
  </article>
  <div class="pagination">
    
      <a href="/comment-afficher-un-exemple-de-toutes-les-polices-dans-microsoft-word/" class="button left"><span>Comment afficher un exemple de toutes les polices dans Microsoft Word</span></a>
    
    
      <a href="/csvplot-a-command-line-script-which-uses-microsoft-excel-to-plot-a-graph-from-a-comma-separated-values-csv-file/" class="button right"><span>csvplot ‚Äì A command line script which uses Microsoft Excel to plot a graph from a Comma-separated values (CSV) file</span></a>
    
  </div>

      </main>
      <section id="site-sidebar">
  
    <section id="recent-posts">
      <header>
        <h1>Recent Posts</h1>
      </header>
      
      <article class="mini-post">
          <a href="/pidvr-record-over-the-air-tv-on-a-raspberry-pi-4/" class="image" style="--bg-image: url('http://www.end2endzone.com/wp-content/uploads/2021/03/PiDVR-Record-over-the-air-TV-on-a-Raspberry-Pi-4.jpg');">
    <img class="stretchV" src="http://www.end2endzone.com/wp-content/uploads/2021/03/PiDVR-Record-over-the-air-TV-on-a-Raspberry-Pi-4.jpg" alt="">
  </a>
        <header>
          <h2><a href="/pidvr-record-over-the-air-tv-on-a-raspberry-pi-4/">PiDVR Record over the air TV on a Raspberry Pi 4</a></h2>
          <time class="published" datetime="2021-03-14 19:40:03 &#43;0000 &#43;0000">March 14, 2021</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/how-to-setup-macos-catalina-10-15-in-virtualbox-for-c-development-on-github/" class="image" style="--bg-image: url('http://www.end2endzone.com/wp-content/uploads/2021/03/HOW-TO-SETUP-MACOS-CATALINA-10.15-IN-VIRTUALBOX-FOR-C-DEVELOPMENT-ON-GITHUB.jpg');">
    <img class="stretchV" src="http://www.end2endzone.com/wp-content/uploads/2021/03/HOW-TO-SETUP-MACOS-CATALINA-10.15-IN-VIRTUALBOX-FOR-C-DEVELOPMENT-ON-GITHUB.jpg" alt="">
  </a>
        <header>
          <h2><a href="/how-to-setup-macos-catalina-10-15-in-virtualbox-for-c-development-on-github/">How to setup macOS Catalina 10.15 in VirtualBox for C&#43;&#43; development on Github.</a></h2>
          <time class="published" datetime="2021-03-14 16:42:39 &#43;0000 &#43;0000">March 14, 2021</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/how-to-encode-command-line-parameters-on-windows-done-right/" class="image" style="--bg-image: url('http://www.end2endzone.com/wp-content/uploads/2017/06/How-to-encode-command-line-parameters-on-Windows-done-right.jpg');">
    <img class="stretchV" src="http://www.end2endzone.com/wp-content/uploads/2017/06/How-to-encode-command-line-parameters-on-Windows-done-right.jpg" alt="">
  </a>
        <header>
          <h2><a href="/how-to-encode-command-line-parameters-on-windows-done-right/">How to encode command line parameters on Windows ‚Äì done right</a></h2>
          <time class="published" datetime="2021-03-14 14:49:47 &#43;0000 &#43;0000">March 14, 2021</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/libargvcodec-a-c-library-which-properly-encode-and-decode-command-line-arguments/" class="image" style="--bg-image: url('http://www.end2endzone.com/wp-content/uploads/2017/06/libArgvCodec-cplusplus-library.jpg');">
    <img class="stretchV" src="http://www.end2endzone.com/wp-content/uploads/2017/06/libArgvCodec-cplusplus-library.jpg" alt="">
  </a>
        <header>
          <h2><a href="/libargvcodec-a-c-library-which-properly-encode-and-decode-command-line-arguments/">libArgvCodec ‚Äì A c&#43;&#43; library which properly encode and decode command line arguments</a></h2>
          <time class="published" datetime="2017-06-25 16:02:08 &#43;0000 &#43;0000">June 25, 2017</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/libvariant-a-c-library-which-encapsulate-any-value-of-variant-types/" class="image" style="--bg-image: url('http://www.end2endzone.com/wp-content/uploads/2016/10/libVariant-cplusplus-library.jpg');">
    <img class="stretchV" src="http://www.end2endzone.com/wp-content/uploads/2016/10/libVariant-cplusplus-library.jpg" alt="">
  </a>
        <header>
          <h2><a href="/libvariant-a-c-library-which-encapsulate-any-value-of-variant-types/">libVariant ‚Äì A c&#43;&#43; library which encapsulate any value of variant types</a></h2>
          <time class="published" datetime="2017-05-28 21:06:45 &#43;0000 &#43;0000">May 28, 2017</time>
        </header>
      </article>
      
      
        <footer>
          <a href="/blog" class="button">See More</a>
        </footer>
      
    </section>
  

  
    

      <section id="categories">
        <header>
          <h1><a href="/categories">Categories</a></h1>
        </header>
        <ul>
          
          
          <li>
              <a href="/categories/photography/">photography<span class="count">28</span></a>
          
          <li>
              <a href="/categories/development/">development<span class="count">22</span></a>
          
          <li>
              <a href="/categories/model-aeronautics/">model-aeronautics<span class="count">17</span></a>
          
          <li>
              <a href="/categories/other/">other<span class="count">9</span></a>
          
          </li>
        </ul>
      </section>
    
  

  
    <section id="mini-bio">
      <header>
        <h1>About</h1>
      </header>
      <p>Hey! I'm Antoine author of end2end zone. Take a couple of minutes to get to know me a little better.</p>
      <footer>
        <a href="/about" class="button">Learn More</a>
      </footer>
    </section>
  
</section>

      <footer id="site-footer">
  
      <ul class="socnet-icons">
        

        <li><a href="//github.com/end2endzone" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>

<li><a href="//stackoverflow.com/users/16481711" target="_blank" rel="noopener" title="Stack Overflow" class="fab fa-stack-overflow"></a></li>




<li><a href="//flickr.com/photos/154618444@N05" target="_blank" rel="noopener" title="Flickr" class="fab fa-flickr"></a></li>









<li><a href="//facebook.com/antoine.beauchamp.90" target="_blank" rel="noopener" title="Facebook" class="fab fa-facebook"></a></li>
























      </ul>
  
  <p class="copyright">
    ¬© 2021 end2end zone
      <br>
    Theme: <a href='https://github.com/pacollins/hugo-future-imperfect-slim' target='_blank' rel='noopener'>Hugo Future Imperfect Slim</a><br>A <a href='https://html5up.net/future-imperfect' target='_blank' rel='noopener'>HTML5 UP port</a> | Powered by <a href='https://gohugo.io/' title='0.87.0' target='_blank' rel='noopener'>Hugo</a>
  </p>
</footer>
<a id="back-to-top" href="#" class="fas fa-arrow-up fa-2x"></a>

      <script src="/js/highlight.js"></script>
    
    <script>hljs.highlightAll();</script><script src="/js/bundle.min.39adb39dffa72bed50ca8645960f6b9219acce210b25d40c697ef8916c8e07e3.js" integrity="sha256-Oa2znf&#43;nK&#43;1QyoZFlg9rkhmsziELJdQMaX74kWyOB&#43;M="></script>
    <script src="/js/add-on.js"></script>
    </div>
  </body>
</html>
